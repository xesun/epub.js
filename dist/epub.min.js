(function(e,t){'object'==typeof exports&&'object'==typeof module?module.exports=t(require('xmldom'),function(){try{return require('JSZip')}catch(t){}}()):'function'==typeof define&&define.amd?define(['xmldom','JSZip'],t):'object'==typeof exports?exports.ePub=t(require('xmldom'),function(){try{return require('JSZip')}catch(t){}}()):e.ePub=t(e.xmldom,e.JSZip)})(this,function(e,t){var n=String.prototype,a=Math.ceil,i=Math.round,s=Math.max,o=Math.floor;return function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(n,'a',n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='/dist/',t(t.s=23)}([function(e,t,n){'use strict';function i(){var e=new Date().getTime(),t='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(t){var n=0|(e+16*Math.random())%16;return e=o(e/16),('x'==t?n:8|7&n).toString(16)});return t}function a(e){return!isNaN(parseFloat(e))&&isFinite(e)}function r(e,t,n,i,a){var s=i||0,o=a||t.length,l=parseInt(s+(o-s)/2),d;return(n||(n=function(e,t){return e>t?1:e<t?-1:e==t?0:void 0}),0>=o-s)?l:(d=n(t[l],e),1==o-s?0<=d?l:l+1:0===d?l:-1===d?r(e,t,n,l,o):r(e,t,n,s,l))}function l(e,t,n,i,a){var s=i||0,o=a||t.length,r=parseInt(s+(o-s)/2),d;return(n||(n=function(e,t){return e>t?1:e<t?-1:e==t?0:void 0}),0>=o-s)?-1:(d=n(t[r],e),1==o-s?0===d?r:-1:0===d?r:-1===d?l(e,t,n,r,o):l(e,t,n,s,r))}function d(e,t){for(var n=e.parentNode,a=n.childNodes,s=-1,o=0,i;o<a.length&&(i=a[o],i.nodeType===t&&s++,i!=e);o++);return s}function c(e,t){return new Blob([e],{type:t})}function p(e,t){return'undefined'==typeof e.querySelector?e.getElementsByTagName(t):e.querySelectorAll(t)}function h(e,t,n){for(var i=document.createTreeWalker(e,n,null,!1),a;a=i.nextNode();)t(a)}function u(e,t){if(t(e))return!0;if(e=e.firstChild,e)do{var n=u(e,t);if(n)return!0;e=e.nextSibling}while(e)}function g(e){for(var t=[e];e;e=e.parentNode)t.unshift(e);return t}Object.defineProperty(t,'__esModule',{value:!0}),t.uuid=i,t.documentHeight=function(){return s(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)},t.isElement=function(e){return!!(e&&1==e.nodeType)},t.isNumber=a,t.isFloat=function(e){var t=parseFloat(e);return t===e&&a(e)&&o(t)!==e},t.prefixed=function(e){var t=['Webkit','webkit','Moz','O','ms'],n=['-webkit-','-webkit-','-moz-','-o-','-ms-'],a=e[0].toUpperCase()+e.slice(1),s=t.length;if('undefined'==typeof document||'undefined'!=typeof document.body.style[e])return e;for(var o=0;o<s;o++)if('undefined'!=typeof document.body.style[t[o]+a])return n[o]+e;return e},t.defaults=function(e){for(var t=1,n=arguments.length,i;t<n;t++)for(var a in i=arguments[t],i)void 0===e[a]&&(e[a]=i[a]);return e},t.extend=function(e){var t=[].slice.call(arguments,1);return t.forEach(function(t){t&&Object.getOwnPropertyNames(t).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}),e},t.insert=function(e,t,n){var i=r(e,t,n);return t.splice(i,0,e),i},t.locationOf=r,t.indexOfSorted=l,t.bounds=function(e){var t=window.getComputedStyle(e),n=0,i=0;return['width','paddingRight','paddingLeft','marginRight','marginLeft','borderRightWidth','borderLeftWidth'].forEach(function(e){n+=parseFloat(t[e])||0}),['height','paddingTop','paddingBottom','marginTop','marginBottom','borderTopWidth','borderBottomWidth'].forEach(function(e){i+=parseFloat(t[e])||0}),{height:i,width:n}},t.borders=function(e){var t=window.getComputedStyle(e),n=0,i=0;return['paddingRight','paddingLeft','marginRight','marginLeft','borderRightWidth','borderLeftWidth'].forEach(function(e){n+=parseFloat(t[e])||0}),['paddingTop','paddingBottom','marginTop','marginBottom','borderTopWidth','borderBottomWidth'].forEach(function(e){i+=parseFloat(t[e])||0}),{height:i,width:n}},t.windowBounds=function(){var e=window.innerWidth,t=window.innerHeight;return{top:0,left:0,right:e,bottom:t,width:e,height:t}},t.indexOfNode=d,t.indexOfTextNode=function(e){return d(e,y)},t.indexOfElementNode=function(e){return d(e,f)},t.isXml=function(e){return-1<['xml','opf','ncx'].indexOf(e)},t.createBlob=c,t.createBlobUrl=function(e,t){var n=c(e,t),i;return i=b.createObjectURL(n),i},t.revokeBlobUrl=function(e){return b.revokeObjectURL(e)},t.createBase64Url=function(e,t){var n,i;if('string'==typeof e)return n=btoa(encodeURIComponent(e)),i='data:'+t+';base64,'+n,i},t.type=function(e){return Object.prototype.toString.call(e).slice(8,-1)},t.parse=function(e,t,i){var a,s;return s='undefined'==typeof DOMParser||i?n(15).DOMParser:DOMParser,65279===e.charCodeAt(0)&&(e=e.slice(1)),a=new s().parseFromString(e,t),a},t.qs=function(e,t){var n;if(!e)throw new Error('No Element Provided');return'undefined'==typeof e.querySelector?(n=e.getElementsByTagName(t),n.length)?n[0]:void 0:e.querySelector(t)},t.qsa=p,t.qsp=function(e,t,n){var i,a;if('undefined'!=typeof e.querySelector){for(var s in t+='[',n)t+=s+'~=\''+n[s]+'\'';return t+=']',e.querySelector(t)}return(i=e.getElementsByTagName(t),a=Array.prototype.slice.call(i,0).filter(function(e){for(var t in n)if(e.getAttribute(t)===n[t])return!0;return!1}),a)?a[0]:void 0},t.sprint=function(e,t){var n=e.ownerDocument||e;'undefined'==typeof n.createTreeWalker?u(e,function(e){e&&3===e.nodeType&&t(e)},!0):h(e,t,NodeFilter.SHOW_TEXT)},t.treeWalker=h,t.walk=u,t.blob2base64=function(e){return new Promise(function(t){var n=new FileReader;n.readAsDataURL(e),n.onloadend=function(){t(n.result)}})},t.defer=function(){this.resolve=null,this.reject=null,this.id=i(),this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t}),Object.freeze(this)},t.querySelectorByType=function(e,t,n){var a;if('undefined'!=typeof e.querySelector&&(a=e.querySelector(`${t}[*|type="${n}"]`)),!a||0===a.length){a=p(e,t);for(var s=0;s<a.length;s++)if(a[s].getAttributeNS('http://www.idpf.org/2007/ops','type')===n||a[s].getAttribute('epub:type')===n)return a[s]}else return a},t.findChildren=function(e){for(var t=[],n=e.childNodes,a=0,i;a<n.length;a++)i=n[a],1===i.nodeType&&t.push(i);return t},t.parents=g,t.filterChildren=function(e,t,n){for(var a=[],s=e.childNodes,o=0,i;o<s.length;o++)if(i=s[o],1===i.nodeType&&i.nodeName.toLowerCase()===t){if(n)return i;a.push(i)}if(!n)return a},t.getParentByTagName=function(e,t){var n;if(null!==e&&''!==t)for(n=e.parentNode;1===n.nodeType;){if(n.tagName.toLowerCase()===t)return n;n=n.parentNode}};var m=t.requestAnimationFrame='undefined'!=typeof window&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame),f=1,y=3,b='undefined'==typeof URL?'undefined'==typeof window?void 0:window.URL||window.webkitURL||window.mozURL:URL;t.RangeObject=class{constructor(){this.collapsed=!1,this.commonAncestorContainer=void 0,this.endContainer=void 0,this.endOffset=void 0,this.startContainer=void 0,this.startOffset=void 0}setStart(e,t){this.startContainer=e,this.startOffset=t,this.endContainer?this.commonAncestorContainer=this._commonAncestorContainer():this.collapse(!0),this._checkCollapsed()}setEnd(e,t){this.endContainer=e,this.endOffset=t,this.startContainer?(this.collapsed=!1,this.commonAncestorContainer=this._commonAncestorContainer()):this.collapse(!1),this._checkCollapsed()}collapse(e){this.collapsed=!0,e?(this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.commonAncestorContainer=this.startContainer.parentNode):(this.startContainer=this.endContainer,this.startOffset=this.endOffset,this.commonAncestorContainer=this.endOffset.parentNode)}selectNode(e){var t=e.parentNode,n=Array.prototype.indexOf.call(t.childNodes,e);this.setStart(t,n),this.setEnd(t,n+1)}selectNodeContents(e){var t=e.childNodes[e.childNodes-1],n=3===e.nodeType?e.textContent.length:parent.childNodes.length;this.setStart(e,0),this.setEnd(e,n)}_commonAncestorContainer(e,t){var n=g(e||this.startContainer),a=g(t||this.endContainer);if(n[0]==a[0])for(var s=0;s<n.length;s++)if(n[s]!=a[s])return n[s-1]}_checkCollapsed(){this.collapsed=this.startContainer===this.endContainer&&this.startOffset===this.endOffset}toString(){}}},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var a=n(0),s=1,o=3;class r{constructor(e,t,n){var i;if(this.str='',this.base={},this.spinePos=0,this.range=!1,this.path={},this.start=null,this.end=null,!(this instanceof r))return new r(e,t,n);if('string'==typeof t?this.base=this.parseComponent(t):'object'==typeof t&&t.steps&&(this.base=t),i=this.checkType(e),'string'===i)return this.str=e,(0,a.extend)(this,this.parse(e));if('range'===i)return(0,a.extend)(this,this.fromRange(e,this.base,n));if('node'===i)return(0,a.extend)(this,this.fromNode(e,this.base,n));if('EpubCFI'===i&&e.path)return e;if(!e)return this;throw new TypeError('not a valid argument for EpubCFI')}checkType(e){return this.isCfiString(e)?'string':'object'==typeof e&&('Range'===(0,a.type)(e)||'undefined'!=typeof e.startContainer)?'range':'object'==typeof e&&'undefined'!=typeof e.nodeType?'node':'object'==typeof e&&e instanceof r&&'EpubCFI'}parse(e){var t={spinePos:-1,range:!1,base:{},path:{},start:null,end:null},n,i,a;return'string'==typeof e?(0===e.indexOf('epubcfi(')&&')'===e[e.length-1]&&(e=e.slice(8,e.length-1)),n=this.getChapterComponent(e),!n)?{spinePos:-1}:(t.base=this.parseComponent(n),i=this.getPathComponent(e),t.path=this.parseComponent(i),a=this.getRange(e),a&&(t.range=!0,t.start=this.parseComponent(a[0]),t.end=this.parseComponent(a[1])),t.spinePos=t.base.steps[1].index,t):{spinePos:-1}}parseComponent(e){var t={steps:[],terminal:{offset:null,assertion:null}},n=e.split(':'),i=n[0].split('/'),a;return 1<n.length&&(a=n[1],t.terminal=this.parseTerminal(a)),''===i[0]&&i.shift(),t.steps=i.map(function(e){return this.parseStep(e)}.bind(this)),t}parseStep(e){var t,n,i,a,s;if(a=e.match(/\[(.*)\]/),a&&a[1]&&(s=a[1]),n=parseInt(e),!isNaN(n))return 0==n%2?(t='element',i=n/2-1):(t='text',i=(n-1)/2),{type:t,index:i,id:s||null}}parseTerminal(e){var t=e.match(/\[(.*)\]/),n,i;return t&&t[1]?(n=parseInt(e.split('[')[0]),i=t[1]):n=parseInt(e),(0,a.isNumber)(n)||(n=null),{offset:n,assertion:i}}getChapterComponent(e){var t=e.split('!');return t[0]}getPathComponent(e){var t=e.split('!');if(t[1]){var n=t[1].split(',');return n[0]}}getRange(e){var t=e.split(',');return!(3!==t.length)&&[t[1],t[2]]}getCharecterOffsetComponent(e){var t=e.split(':');return t[1]||''}joinSteps(e){return e?e.map(function(e){var t='';return'element'===e.type&&(t+=2*(e.index+1)),'text'===e.type&&(t+=1+2*e.index),e.id&&(t+='['+e.id+']'),t}).join('/'):''}segmentString(e){var t='/';return t+=this.joinSteps(e.steps),e.terminal&&null!=e.terminal.offset&&(t+=':'+e.terminal.offset),e.terminal&&null!=e.terminal.assertion&&(t+='['+e.terminal.assertion+']'),t}toString(){var e='epubcfi(';return e+=this.segmentString(this.base),e+='!',e+=this.segmentString(this.path),this.range&&this.start&&(e+=',',e+=this.segmentString(this.start)),this.range&&this.end&&(e+=',',e+=this.segmentString(this.end)),e+=')',e}compare(e,t){var n,a,s,o,l,l;if('string'==typeof e&&(e=new r(e)),'string'==typeof t&&(t=new r(t)),e.spinePos>t.spinePos)return 1;if(e.spinePos<t.spinePos)return-1;e.range?(n=e.path.steps.concat(e.start.steps),s=e.start.terminal):(n=e.path.steps,s=e.path.terminal),t.range?(a=t.path.steps.concat(t.start.steps),o=t.start.terminal):(a=t.path.steps,o=t.path.terminal);for(var d=0;d<n.length;d++){if(!n[d])return-1;if(!a[d])return 1;if(n[d].index>a[d].index)return 1;if(n[d].index<a[d].index)return-1}return n.length<a.length?1:s.offset>o.offset?1:s.offset<o.offset?-1:0}step(e){var t=e.nodeType===o?'text':'element';return{id:e.id,tagName:e.tagName,type:t,index:this.position(e)}}filteredStep(e,t){var n=this.filter(e,t),i;if(n)return i=n.nodeType===o?'text':'element',{id:n.id,tagName:n.tagName,type:i,index:this.filteredPosition(n,t)}}pathTo(e,t,n){for(var i={steps:[],terminal:{offset:null,assertion:null}},a=e,s;a&&a.parentNode&&a.parentNode.nodeType!=9;)s=n?this.filteredStep(a,n):this.step(a),s&&i.steps.unshift(s),a=a.parentNode;return null!=t&&0<=t&&(i.terminal.offset=t,'text'!=i.steps[i.steps.length-1].type&&i.steps.push({type:'text',index:0})),i}equalStep(e,t){return e&&t&&e.index===t.index&&e.id===t.id&&e.type===t.type}fromRange(e,t,n){var a={range:!1,base:{},path:{},start:null,end:null},s=e.startContainer,o=e.endContainer,r=e.startOffset,l=e.endOffset,d=!1;if(n&&(d=null!=s.ownerDocument.querySelector('.'+n)),'string'==typeof t?(a.base=this.parseComponent(t),a.spinePos=a.base.steps[1].index):'object'==typeof t&&(a.base=t),e.collapsed)d&&(r=this.patchOffset(s,r,n)),a.path=this.pathTo(s,r,n);else{a.range=!0,d&&(r=this.patchOffset(s,r,n)),a.start=this.pathTo(s,r,n),d&&(l=this.patchOffset(o,l,n)),a.end=this.pathTo(o,l,n),a.path={steps:[],terminal:null};var c=a.start.steps.length,p;for(p=0;p<c&&this.equalStep(a.start.steps[p],a.end.steps[p]);p++)p===c-1?a.start.terminal===a.end.terminal&&(a.path.steps.push(a.start.steps[p]),a.range=!1):a.path.steps.push(a.start.steps[p]);a.start.steps=a.start.steps.slice(a.path.steps.length),a.end.steps=a.end.steps.slice(a.path.steps.length)}return a}fromNode(e,t,n){var i={range:!1,base:{},path:{},start:null,end:null};return'string'==typeof t?(i.base=this.parseComponent(t),i.spinePos=i.base.steps[1].index):'object'==typeof t&&(i.base=t),i.path=this.pathTo(e,null,n),i}filter(e,t){var n=!1,i,a,s,r,l;return e.nodeType===o?(n=!0,s=e.parentNode,i=e.parentNode.classList.contains(t)):(n=!1,i=e.classList.contains(t)),i&&n?(r=s.previousSibling,l=s.nextSibling,r&&r.nodeType===o?a=r:l&&l.nodeType===o&&(a=l),a?a:e):i&&!n?!1:e}patchOffset(e,t,n){if(e.nodeType!=o)throw new Error('Anchor must be a text node');var i=e,a=t;for(e.parentNode.classList.contains(n)&&(i=e.parentNode);i.previousSibling;){if(!(i.previousSibling.nodeType===s))a+=i.previousSibling.textContent.length;else if(i.previousSibling.classList.contains(n))a+=i.previousSibling.textContent.length;else break;i=i.previousSibling}return a}normalizedMap(e,t,n){var a={},r=-1,l=e.length,d,i,c;for(d=0;d<l;d++)i=e[d].nodeType,i===s&&e[d].classList.contains(n)&&(i=o),0<d&&i===o&&c===o?a[d]=r:t===i&&(++r,a[d]=r),c=i;return a}position(e){var t,n;return e.nodeType===s?(t=e.parentNode.children,!t&&(t=(0,a.findChildren)(e.parentNode)),n=Array.prototype.indexOf.call(t,e)):(t=this.textNodes(e.parentNode),n=t.indexOf(e)),n}filteredPosition(e,t){var n,i,a;return e.nodeType===s?(n=e.parentNode.children,a=this.normalizedMap(n,s,t)):(n=e.parentNode.childNodes,e.parentNode.classList.contains(t)&&(e=e.parentNode,n=e.parentNode.childNodes),a=this.normalizedMap(n,o,t)),i=Array.prototype.indexOf.call(n,e),a[i]}stepsToXpath(e){var t=['.','*'];return e.forEach(function(e){var n=e.index+1;e.id?t.push('*[position()='+n+' and @id=\''+e.id+'\']'):'text'===e.type?t.push('text()['+n+']'):t.push('*['+n+']')}),t.join('/')}stepsToQuerySelector(e){var t=['html'];return e.forEach(function(e){var n=e.index+1;e.id?t.push('#'+e.id):'text'===e.type||t.push('*:nth-child('+n+')')}),t.join('>')}textNodes(e,t){return Array.prototype.slice.call(e.childNodes).filter(function(e){if(e.nodeType===o)return!0;return t&&e.classList.contains(t)})}walkToNode(e,t,n){var s=t||document,o=s.documentElement,r=e.length,l,d,c;for(c=0;c<r&&(d=e[c],'element'===d.type?d.id?o=s.getElementById(d.id):(l=o.children||(0,a.findChildren)(o),o=l[d.index]):'text'===d.type&&(o=this.textNodes(o,n)[d.index]),!!o);c++);return o}findNode(e,t,n){var i=t||document,a,s;return n||'undefined'==typeof i.evaluate?n?a=this.walkToNode(e,i,n):a=this.walkToNode(e,i):(s=this.stepsToXpath(e),a=i.evaluate(s,i,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),a}fixMiss(e,t,n,i){var a=this.findNode(e.slice(0,-1),n,i),r=a.childNodes,l=this.normalizedMap(r,o,i),d=e[e.length-1].index,c,p;for(var h in l){if(!l.hasOwnProperty(h))return;if(l[h]===d)if(c=r[h],p=c.textContent.length,t>p)t-=p;else{a=c.nodeType===s?c.childNodes[0]:c;break}}return{container:a,offset:t}}toRange(e,t){var n=e||document,i=this,s=!!t&&null!=n.querySelector('.'+t),o,r,l,d,c,p,h,u;if(o='undefined'==typeof n.createRange?new a.RangeObject:n.createRange(),i.range?(r=i.start,p=i.path.steps.concat(r.steps),d=this.findNode(p,n,s?t:null),l=i.end,h=i.path.steps.concat(l.steps),c=this.findNode(h,n,s?t:null)):(r=i.path,p=i.path.steps,d=this.findNode(i.path.steps,n,s?t:null)),d)try{null==r.terminal.offset?o.setStart(d,0):o.setStart(d,r.terminal.offset)}catch(i){u=this.fixMiss(p,r.terminal.offset,n,s?t:null),o.setStart(u.container,u.offset)}else return console.log('No startContainer found for',this.toString()),null;if(c)try{null==l.terminal.offset?o.setEnd(c,0):o.setEnd(c,l.terminal.offset)}catch(a){u=this.fixMiss(h,i.end.terminal.offset,n,s?t:null),o.setEnd(u.container,u.offset)}return o}isCfiString(e){return'string'==typeof e&&0===e.indexOf('epubcfi(')&&')'===e[e.length-1]}generateChapterComponent(e,t,n){var i=parseInt(t),a='/'+2*(e+1)+'/';return a+=2*(i+1),n&&(a+='['+n+']'),a}collapse(e){this.range&&(this.range=!1,e?(this.path.steps=this.path.steps.concat(this.start.steps),this.path.terminal=this.start.terminal):(this.path.steps=this.path.steps.concat(this.end.steps),this.path.terminal=this.end.terminal))}}t.default=r,e.exports=t['default']},function(e,t,n){'use strict';var i=n(25),a=n(39),s=Function.prototype.apply,o=Function.prototype.call,r=Object.create,l=Object.defineProperty,d=Object.defineProperties,c=Object.prototype.hasOwnProperty,p={configurable:!0,enumerable:!1,writable:!0},h,u,g,m,f,y,b;h=function(e,t){var n;return a(t),c.call(this,'__ee__')?n=this.__ee__:(n=p.value=r(null),l(this,'__ee__',p),p.value=null),n[e]?'object'==typeof n[e]?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},u=function(e,t){var n,i;return a(t),i=this,h.call(this,e,n=function(){g.call(i,e,n),s.call(t,this,arguments)}),n.__eeOnceListener__=t,this},g=function(e,t){var n,s,o,r;if(a(t),!c.call(this,'__ee__'))return this;if(n=this.__ee__,!n[e])return this;if(s=n[e],'object'==typeof s)for(r=0;o=s[r];++r)(o===t||o.__eeOnceListener__===t)&&(2===s.length?n[e]=s[r?0:1]:s.splice(r,1));else(s===t||s.__eeOnceListener__===t)&&delete n[e];return this},m=function(e){var t,n,i,a,r;if(c.call(this,'__ee__')&&(a=this.__ee__[e],!!a))if('object'==typeof a){for(n=arguments.length,r=Array(n-1),t=1;t<n;++t)r[t-1]=arguments[t];for(a=a.slice(),t=0;i=a[t];++t)s.call(i,this,r)}else switch(arguments.length){case 1:o.call(a,this);break;case 2:o.call(a,this,arguments[1]);break;case 3:o.call(a,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,r=Array(n-1),t=1;t<n;++t)r[t-1]=arguments[t];s.call(a,this,r);}},f={on:h,once:u,off:g,emit:m},y={on:i(h),once:i(u),off:i(g),emit:i(m)},b=d({},y),e.exports=t=function(e){return null==e?r(b):d(Object(e),y)},t.methods=f},function(e,t){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var n=t.DOM_EVENTS=['keydown','keyup','keypressed','mouseup','mousedown','click','touchend','touchstart'],i=t.EVENTS={BOOK:{OPEN_FAILED:'openFailed'},CONTENTS:{EXPAND:'expand',RESIZE:'resize',SELECTED:'selected',SELECTED_RANGE:'selectedRange',LINK_CLICKED:'linkClicked'},LOCATIONS:{CHANGED:'changed'},MANAGERS:{RESIZE:'resize',RESIZED:'resized',ORIENTATION_CHANGE:'orientationchange',ADDED:'added',SCROLL:'scroll',SCROLLED:'scrolled'},VIEWS:{AXIS:'axis',LOAD_ERROR:'loaderror',RENDERED:'rendered',RESIZED:'resized',DISPLAYED:'displayed',SHOWN:'shown',HIDDEN:'hidden',MARK_CLICKED:'markClicked'},RENDITION:{STARTED:'started',ATTACHED:'attached',DISPLAYED:'displayed',DISPLAY_ERROR:'displayerror',RENDERED:'rendered',REMOVED:'removed',RESIZED:'resized',ORIENTATION_CHANGE:'orientationchange',LOCATION_CHANGED:'locationChanged',RELOCATED:'relocated',MARK_CLICKED:'markClicked',SELECTED:'selected',LAYOUT:'layout'},LAYOUT:{UPDATED:'updated'}}},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var i=n(6),a=function(e){return e&&e.__esModule?e:{default:e}}(i);t.default=class{constructor(e){var t,n;t=e.indexOf('://'),-1<t&&(e=new URL(e).pathname),n=this.parse(e),this.path=e,this.directory=this.isDirectory(e)?e:n.dir+'/',this.filename=n.base,this.extension=n.ext.slice(1)}parse(e){return a.default.parse(e)}isAbsolute(e){return a.default.isAbsolute(e||this.path)}isDirectory(e){return'/'===e.charAt(e.length-1)}resolve(e){return a.default.resolve(this.directory,e)}relative(e){return a.default.relative(this.directory,e)}splitPath(e){return this.splitPathRe.exec(e).slice(1)}toString(){return this.path}},e.exports=t['default']},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0});var a=n(4),s=i(a),o=n(6),r=i(o);t.default=class{constructor(e,t){var n=-1<e.indexOf('://'),i=e,a;if(this.Url=void 0,this.href=e,this.protocol='',this.origin='',this.hash='',this.hash='',this.search='',this.base=t,!n&&!1!==t&&'string'!=typeof t&&window&&window.location&&(this.base=window.location.href),n||this.base)try{this.Url=this.base?new URL(e,this.base):new URL(e),this.href=this.Url.href,this.protocol=this.Url.protocol,this.origin=this.Url.origin,this.hash=this.Url.hash,this.search=this.Url.search,i=this.Url.pathname}catch(t){this.Url=void 0,this.base&&(a=new s.default(this.base),i=a.resolve(i))}this.Path=new s.default(i),this.directory=this.Path.directory,this.filename=this.Path.filename,this.extension=this.Path.extension}path(){return this.Path}resolve(e){var t=-1<e.indexOf('://'),n;return t?e:(n=r.default.resolve(this.directory,e),this.origin+n)}relative(e){return r.default.relative(e,this.directory)}toString(){return this.href}},e.exports=t['default']},function(e){'use strict';function t(e){if('string'!=typeof e)throw new TypeError('Path must be a string. Received '+e)}function n(e,t){for(var n='',a=-1,s=0,o=0,i;o<=e.length;++o){if(o<e.length)i=e.charCodeAt(o);else if(47===i)break;else i=47;if(47===i){if(a==o-1||1==s);else if(a!=o-1&&2==s){if(2>n.length||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(2<n.length){for(var r=n.length-1,l=r;0<=l&&47!==n.charCodeAt(l);--l);if(l!=r){n=-1==l?'':n.slice(0,l),a=o,s=0;continue}}else if(2===n.length||1===n.length){n='',a=o,s=0;continue}t&&(0<n.length?n+='/..':n='..')}else 0<n.length?n+='/'+e.slice(a+1,o):n=e.slice(a+1,o);a=o,s=0}else 46===i&&-1!=s?++s:s=-1}return n}function i(e,t){var n=t.dir||t.root,i=t.base||(t.name||'')+(t.ext||'');return n?n===t.root?n+i:n+e+i:i}if(!a)var a={cwd:function(){return'/'}};var s={resolve:function(){for(var e='',s=!1,o=arguments.length-1,i;-1<=o&&!s;o--){var r;(0<=o?r=arguments[o]:(void 0==i&&(i=a.cwd()),r=i),t(r),0!==r.length)&&(e=r+'/'+e,s=47===r.charCodeAt(0))}return e=n(e,!s),s?0<e.length?'/'+e:'/':0<e.length?e:'.'},normalize:function(e){if(t(e),0===e.length)return'.';var i=47===e.charCodeAt(0),a=47===e.charCodeAt(e.length-1);return e=n(e,!i),0!==e.length||i||(e='.'),0<e.length&&a&&(e+='/'),i?'/'+e:e},isAbsolute:function(e){return t(e),0<e.length&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return'.';for(var e=0,n,i;e<arguments.length;++e)i=arguments[e],t(i),0<i.length&&(void 0==n?n=i:n+='/'+i);return void 0===n?'.':s.normalize(n)},relative:function(e,n){if(t(e),t(n),e===n)return'';if(e=s.resolve(e),n=s.resolve(n),e===n)return'';for(var a=1;a<e.length&&47===e.charCodeAt(a);++a);for(var o=e.length,r=o-a,l=1;l<n.length&&47===n.charCodeAt(l);++l);for(var d=n.length,c=d-l,p=r<c?r:c,h=-1,u=0;u<=p;++u){if(u==p){if(c>p){if(47===n.charCodeAt(l+u))return n.slice(l+u+1);if(0==u)return n.slice(l+u)}else r>p&&(47===e.charCodeAt(a+u)?h=u:0==u&&(h=0));break}var i=e.charCodeAt(a+u),g=n.charCodeAt(l+u);if(i!==g)break;else 47===i&&(h=u)}var m='';for(u=a+h+1;u<=o;++u)(u===o||47===e.charCodeAt(u))&&(m+=0===m.length?'..':'/..');return 0<m.length?m+n.slice(l+h):(l+=h,47===n.charCodeAt(l)&&++l,n.slice(l))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return'.';for(var n=e.charCodeAt(0),a=47===n,s=-1,o=!0,r=e.length-1;1<=r;--r)if(n=e.charCodeAt(r),47!==n)o=!1;else if(!o){s=r;break}return-1===s?a?'/':'.':a&&1===s?'//':e.slice(0,s)},basename:function(e,n){if(n!==void 0&&'string'!=typeof n)throw new TypeError('"ext" argument must be a string');t(e);var a=0,s=-1,o=!0,r;if(void 0!==n&&0<n.length&&n.length<=e.length){if(n.length===e.length&&n===e)return'';var i=n.length-1,l=-1;for(r=e.length-1;0<=r;--r){var d=e.charCodeAt(r);if(47!==d)-1==l&&(o=!1,l=r+1),0<=i&&(d===n.charCodeAt(i)?-1==--i&&(s=r):(i=-1,s=l));else if(!o){a=r+1;break}}return a===s?s=l:-1===s&&(s=e.length),e.slice(a,s)}for(r=e.length-1;0<=r;--r)if(47!==e.charCodeAt(r))-1==s&&(o=!1,s=r+1);else if(!o){a=r+1;break}return-1===s?'':e.slice(a,s)},extname:function(e){t(e);for(var n=-1,a=0,s=-1,o=!0,r=0,l=e.length-1,i;0<=l;--l){if(i=e.charCodeAt(l),47===i){if(!o){a=l+1;break}continue}-1==s&&(o=!1,s=l+1),46===i?-1==n?n=l:1!=r&&(r=1):-1!==n&&(r=-1)}return-1===n||-1===s||0==r||1==r&&n===s-1&&n===a+1?'':e.slice(n,s)},format:function(e){if(null===e||'object'!=typeof e)throw new TypeError('Parameter "pathObject" must be an object, not '+typeof e);return i('/',e)},parse:function(e){t(e);var n={root:'',dir:'',base:'',ext:'',name:''};if(0===e.length)return n;var a=e.charCodeAt(0),s=47===a,o;s?(n.root='/',o=1):o=0;for(var r=-1,l=0,d=-1,c=!0,p=e.length-1,i=0;p>=o;--p){if(a=e.charCodeAt(p),47===a){if(!c){l=p+1;break}continue}-1==d&&(c=!1,d=p+1),46===a?-1==r?r=p:1!=i&&(i=1):-1!=r&&(i=-1)}return-1==r||-1==d||0==i||1==i&&r==d-1&&r==l+1?-1!=d&&(0==l&&s?n.base=n.name=e.slice(1,d):n.base=n.name=e.slice(l,d)):(0==l&&s?(n.name=e.slice(1,r),n.base=e.slice(1,d)):(n.name=e.slice(l,r),n.base=e.slice(l,d)),n.ext=e.slice(r,d)),0<l?n.dir=e.slice(0,l-1):s&&(n.dir='/'),n},sep:'/',delimiter:':',posix:null};e.exports=s},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.replaceBase=function(e,t){var n=t.url,i=-1<n.indexOf('://'),s,o;e&&(o=(0,a.qs)(e,'head'),s=(0,a.qs)(o,'base'),!s&&(s=e.createElement('base'),o.insertBefore(s,o.firstChild)),!i&&window&&window.location&&(n=window.location.origin+n),s.setAttribute('href',n))},t.replaceCanonical=function(e,t){var n=t.canonical,i,s;e&&(i=(0,a.qs)(e,'head'),s=(0,a.qs)(i,'link[rel=\'canonical\']'),s?s.setAttribute('href',n):(s=e.createElement('link'),s.setAttribute('rel','canonical'),s.setAttribute('href',n),i.appendChild(s)))},t.replaceMeta=function(e,t){var n=t.idref,i,s;e&&(i=(0,a.qs)(e,'head'),s=(0,a.qs)(i,'link[property=\'dc.identifier\']'),s?s.setAttribute('content',n):(s=e.createElement('meta'),s.setAttribute('name','dc.identifier'),s.setAttribute('content',n),i.appendChild(s)))},t.replaceLinks=function(e,t){var n=e.querySelectorAll('a[href]');if(n.length)for(var s=(0,a.qs)(e.ownerDocument,'base'),r=s?s.getAttribute('href'):void 0,l=function(e){var n=e.getAttribute('href');if(0!==n.indexOf('mailto:')){var i=-1<n.indexOf('://'),a=new o.default(n,r);i?e.setAttribute('target','_blank'):e.onclick=function(){return a&&a.hash?t(a.Path.path+a.hash):a?t(a.Path.path):t(n),!1}}}.bind(this),d=0;d<n.length;d++)l(n[d])},t.substitute=function(e,t,n){return t.forEach(function(t,a){t&&n[a]&&(e=e.replace(new RegExp(t,'g'),n[a]))}),e};var a=n(0),s=n(5),o=i(s),r=n(4),l=i(r)},function(e){var t=function(){return this}();try{t=t||Function('return this')()||(1,eval)('this')}catch(n){'object'==typeof window&&(t=window)}e.exports=t},function(e,t,n){'use strict';var i=n(32)();e.exports=function(e){return e!==i&&null!==e}},function(e,t){'use strict';Object.defineProperty(t,'__esModule',{value:!0});t.default=class{constructor(e){this.context=e||this,this.hooks=[]}register(){for(var e=0;e<arguments.length;++e)if('function'==typeof arguments[e])this.hooks.push(arguments[e]);else for(var t=0;t<arguments[e].length;++t)this.hooks.push(arguments[e][t])}trigger(){var e=arguments,t=this.context,n=[];return this.hooks.forEach(function(i){var a=i.apply(t,e);a&&'function'==typeof a.then&&n.push(a)}),Promise.all(n)}list(){return this.hooks}clear(){return this.hooks=[]}},e.exports=t['default']},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var i=n(0),a=n(4),s=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default=function(e,t,n,a){function o(t){c.reject(t)}function r(){if(this.readyState===XMLHttpRequest.DONE){var e=!1;if((''===this.responseType||'document'===this.responseType)&&(e=this.responseXML),200===this.status||e){var n;if(!this.response&&!e)return c.reject({status:this.status,message:'Empty Response',stack:new Error().stack}),c.promise;if(403===this.status)return c.reject({status:this.status,response:this.response,message:'Forbidden',stack:new Error().stack}),c.promise;n=e?this.responseXML:(0,i.isXml)(t)?(0,i.parse)(this.response,'text/xml'):'xhtml'==t?(0,i.parse)(this.response,'application/xhtml+xml'):'html'==t||'htm'==t?(0,i.parse)(this.response,'text/html'):'json'==t?JSON.parse(this.response):'blob'==t?l?this.response:new Blob([this.response]):this.response,c.resolve(n)}else c.reject({status:this.status,message:this.response,stack:new Error().stack})}}var l='undefined'!=typeof window&&window.URL,d=l?'blob':'arraybuffer',c=new i.defer,p=new XMLHttpRequest,h=XMLHttpRequest.prototype,u;for(u in'overrideMimeType'in h||Object.defineProperty(h,'overrideMimeType',{value:function(){}}),n&&(p.withCredentials=!0),p.onreadystatechange=r,p.onerror=o,p.open('GET',e,!0),a)p.setRequestHeader(u,a[u]);return'json'==t&&p.setRequestHeader('Accept','application/json'),t||(t=new s.default(e).extension),'blob'==t&&(p.responseType=d),(0,i.isXml)(t)&&p.overrideMimeType('text/xml'),'xhtml'==t,'html'!=t&&'htm'!=t,'binary'==t&&(p.responseType='arraybuffer'),p.send(),c.promise},e.exports=t['default']},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.Task=void 0;var i=n(0);t.default=class{constructor(e){this._q=[],this.context=e,this.tick=i.requestAnimationFrame,this.running=!1,this.paused=!1}enqueue(){var e=[].shift.call(arguments),t=arguments,n,a,s;if(!e)throw new Error('No Task Provided');return'function'==typeof e?(n=new i.defer,a=n.promise,s={task:e,args:t,deferred:n,promise:a}):s={promise:e},this._q.push(s),!1!=this.paused||this.running||this.run(),s.promise}dequeue(){var e,t,n;if(this._q.length&&!this.paused){if(e=this._q.shift(),t=e.task,t)return n=t.apply(this.context,e.args),n&&'function'==typeof n.then?n.then(function(){e.deferred.resolve.apply(this.context,arguments)}.bind(this),function(){e.deferred.reject.apply(this.context,arguments)}.bind(this)):(e.deferred.resolve.apply(this.context,n),e.promise);if(e.promise)return e.promise}else return e=new i.defer,e.deferred.resolve(),e.promise}dump(){for(;this._q.length;)this.dequeue()}run(){return this.running||(this.running=!0,this.defered=new i.defer),this.tick.call(window,()=>{this._q.length?this.dequeue().then(function(){this.run()}.bind(this)):(this.defered.resolve(),this.running=void 0)}),!0==this.paused&&(this.paused=!1),this.defered.promise}flush(){return this.running?this.running:this._q.length?(this.running=this.dequeue().then(function(){return this.running=void 0,this.flush()}.bind(this)),this.running):void 0}clear(){this._q=[]}length(){return this._q.length}pause(){this.paused=!0}stop(){this._q=[],this.running=!1,this.paused=!0}},t.Task=class{constructor(e,t,n){return function(){var t=arguments||[];return new Promise((i,a)=>{t.push(function(e,t){!e&&t?a(t):i(e)}),e.apply(n||this,t)})}}}},function(e,t,n){'use strict';function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0});var s=n(2),o=a(s),r=n(0),l=n(1),d=a(l),c=n(18),p=a(c),h=n(7),u=n(3),g=/Chrome/.test(navigator.userAgent),m=!g&&/AppleWebKit/.test(navigator.userAgent);class f{constructor(e,t,n,i){this.epubcfi=new d.default,this.document=e,this.documentElement=this.document.documentElement,this.content=t||this.document.body,this.window=this.document.defaultView,this._size={width:0,height:0},this.sectionIndex=i||0,this.cfiBase=n||'',this.epubReadingSystem('epub.js',ePub.VERSION),this.listeners()}static get listenedEvents(){return u.DOM_EVENTS}width(e){var t=this.content;return e&&(0,r.isNumber)(e)&&(e+='px'),e&&(t.style.width=e),this.window.getComputedStyle(t).width}height(e){var t=this.content;return e&&(0,r.isNumber)(e)&&(e+='px'),e&&(t.style.height=e),this.window.getComputedStyle(t).height}contentWidth(e){var t=this.content||this.document.body;return e&&(0,r.isNumber)(e)&&(e+='px'),e&&(t.style.width=e),this.window.getComputedStyle(t).width}contentHeight(e){var t=this.content||this.document.body;return e&&(0,r.isNumber)(e)&&(e+='px'),e&&(t.style.height=e),this.window.getComputedStyle(t).height}textWidth(){var e=this.document.createRange(),t=this.content||this.document.body,n=(0,r.borders)(t),a;return e.selectNodeContents(t),a=e.getBoundingClientRect().width,n&&n.width&&(a+=n.width),i(a)}textHeight(){var e=this.document.createRange(),t=this.content||this.document.body,n=(0,r.borders)(t),a;return e.selectNodeContents(t),a=e.getBoundingClientRect().height,a&&n.height&&(a+=n.height),i(a)}scrollWidth(){var e=this.documentElement.scrollWidth;return e}scrollHeight(){var e=this.documentElement.scrollHeight;return e}overflow(e){return e&&(this.documentElement.style.overflow=e),this.window.getComputedStyle(this.documentElement).overflow}overflowX(e){return e&&(this.documentElement.style.overflowX=e),this.window.getComputedStyle(this.documentElement).overflowX}overflowY(e){return e&&(this.documentElement.style.overflowY=e),this.window.getComputedStyle(this.documentElement).overflowY}css(e,t,n){var i=this.content||this.document.body;return t&&i.style.setProperty(e,t,n?'important':''),this.window.getComputedStyle(i)[e]}viewport(e){var t=this.document.querySelector('meta[name=\'viewport\']'),n={width:void 0,height:void 0,scale:void 0,minimum:void 0,maximum:void 0,scalable:void 0},i=[],a={};if(t&&t.hasAttribute('content')){var s=t.getAttribute('content'),o=s.match(/width\s*=\s*([^,]*)/),l=s.match(/height\s*=\s*([^,]*)/),d=s.match(/initial-scale\s*=\s*([^,]*)/),c=s.match(/minimum-scale\s*=\s*([^,]*)/),p=s.match(/maximum-scale\s*=\s*([^,]*)/),h=s.match(/user-scalable\s*=\s*([^,]*)/);o&&o.length&&'undefined'!=typeof o[1]&&(n.width=o[1]),l&&l.length&&'undefined'!=typeof l[1]&&(n.height=l[1]),d&&d.length&&'undefined'!=typeof d[1]&&(n.scale=d[1]),c&&c.length&&'undefined'!=typeof c[1]&&(n.minimum=c[1]),p&&p.length&&'undefined'!=typeof p[1]&&(n.maximum=p[1]),h&&h.length&&'undefined'!=typeof h[1]&&(n.scalable=h[1])}return a=(0,r.defaults)(e||{},n),e&&(a.width&&i.push('width='+a.width),a.height&&i.push('height='+a.height),a.scale&&i.push('initial-scale='+a.scale),'no'===a.scalable?(i.push('minimum-scale='+a.scale),i.push('maximum-scale='+a.scale),i.push('user-scalable='+a.scalable)):(a.scalable&&i.push('user-scalable='+a.scalable),a.minimum&&i.push('minimum-scale='+a.minimum),a.maximum&&i.push('minimum-scale='+a.maximum)),!t&&(t=this.document.createElement('meta'),t.setAttribute('name','viewport'),this.document.querySelector('head').appendChild(t)),t.setAttribute('content',i.join(', ')),this.window.scrollTo(0,0)),a}expand(){this.emit(u.EVENTS.CONTENTS.EXPAND)}listeners(){this.imageLoadListeners(),this.mediaQueryListeners(),this.addEventListeners(),this.addSelectionListeners(),this.resizeListeners(),this.linksHandler()}removeListeners(){this.removeEventListeners(),this.removeSelectionListeners(),clearTimeout(this.expanding)}resizeCheck(){var e=this.textWidth(),t=this.textHeight();(e!=this._size.width||t!=this._size.height)&&(this._size={width:e,height:t},this.onResize&&this.onResize(this._size),this.emit(u.EVENTS.CONTENTS.RESIZE,this._size))}resizeListeners(){clearTimeout(this.expanding),requestAnimationFrame(this.resizeCheck.bind(this)),this.expanding=setTimeout(this.resizeListeners.bind(this),350)}transitionListeners(){var e=this.content;e.style.transitionProperty='font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height',e.style.transitionDuration='0.001ms',e.style.transitionTimingFunction='linear',e.style.transitionDelay='0',this.document.addEventListener('transitionend',this.resizeCheck.bind(this))}mediaQueryListeners(){for(var e=this.document.styleSheets,t=function(e){e.matches&&!this._expanding&&setTimeout(this.expand.bind(this),1)}.bind(this),n=0;n<e.length;n+=1){var i;try{i=e[n].cssRules}catch(t){return}if(!i)return;for(var a=0;a<i.length;a+=1)if(i[a].media){var s=this.window.matchMedia(i[a].media.mediaText);s.addListener(t)}}}resizeObservers(){this.observer=new MutationObserver(()=>{this.resizeCheck()});this.observer.observe(this.document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})}imageLoadListeners(){for(var e=this.document.querySelectorAll('img'),t=0,n;t<e.length;t++)n=e[t],'undefined'!=typeof n.naturalWidth&&0===n.naturalWidth&&(n.onload=this.expand.bind(this))}fontLoadListeners(){this.document&&this.document.fonts&&this.document.fonts.ready.then(function(){this.resizeCheck()}.bind(this))}root(){return this.document?this.document.documentElement:null}locationOf(e,t){var n={left:0,top:0},i;if(!this.document)return n;if(this.epubcfi.isCfiString(e)){var a=new d.default(e).toRange(this.document,t);if(a)if(a.startContainer.nodeType===Node.ELEMENT_NODE)i=a.startContainer.getBoundingClientRect(),n.left=i.left,n.top=i.top;else if(m){var s=a.startContainer,o=new Range;try{s.nodeType===1?i=s.getBoundingClientRect():a.startOffset+2<s.length?(o.setStart(s,a.startOffset),o.setEnd(s,a.startOffset+2),i=o.getBoundingClientRect()):0<a.startOffset-2?(o.setStart(s,a.startOffset-2),o.setEnd(s,a.startOffset),i=o.getBoundingClientRect()):i=s.parentNode.getBoundingClientRect()}catch(t){console.error(t,t.stack)}}else i=a.getBoundingClientRect()}else if('string'==typeof e&&-1<e.indexOf('#')){var r=e.substring(e.indexOf('#')+1),l=this.document.getElementById(r);l&&(i=l.getBoundingClientRect())}return i&&(n.left=i.left,n.top=i.top),n}addStylesheet(e){return new Promise(function(t){var n=!1,i;return this.document?(i=this.document.querySelector('link[href=\''+e+'\']'),i?void t(!0):void(i=this.document.createElement('link'),i.type='text/css',i.rel='stylesheet',i.href=e,i.onload=i.onreadystatechange=function(){n||this.readyState&&'complete'!=this.readyState||(n=!0,setTimeout(()=>{t(!0)},1))},this.document.head.appendChild(i))):void t(!1)}.bind(this))}addStylesheetRules(e){var t='epubjs-inserted-css',n,a;if(this.document&&e&&0!==e.length)if(n=this.document.getElementById('#'+t),n||(n=this.document.createElement('style'),n.id=t),this.document.head.appendChild(n),a=n.sheet,'[object Array]'===Object.prototype.toString.call(e))for(var s=0,i=e.length;s<i;s++){var o=1,r=e[s],l=e[s][0],d='';'[object Array]'===Object.prototype.toString.call(r[1][0])&&(r=r[1],o=0);for(var c=r.length,p;o<c;o++)p=r[o],d+=p[0]+':'+p[1]+(p[2]?' !important':'')+';\n';a.insertRule(l+'{'+d+'}',a.cssRules.length)}else{var h=Object.keys(e);h.forEach((t)=>{var n=e[t];if(Array.isArray(n))n.forEach((e)=>{var n=Object.keys(e),i=n.map((t)=>{return`${t}:${e[t]}`}).join(';');a.insertRule(`${t}{${i}}`,a.cssRules.length)});else{var i=Object.keys(n),s=i.map((e)=>{return`${e}:${n[e]}`}).join(';');a.insertRule(`${t}{${s}}`,a.cssRules.length)}})}}addScript(e){return new Promise(function(t){var n=!1,i;return this.document?void(i=this.document.createElement('script'),i.type='text/javascript',i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){n||this.readyState&&'complete'!=this.readyState||(n=!0,setTimeout(function(){t(!0)},1))},this.document.head.appendChild(i)):void t(!1)}.bind(this))}addClass(e){var t;this.document&&(t=this.content||this.document.body,t&&t.classList.add(e))}removeClass(e){var t;this.document&&(t=this.content||this.document.body,t&&t.classList.remove(e))}addEventListeners(){this.document&&u.DOM_EVENTS.forEach(function(e){this.document.addEventListener(e,this.triggerEvent.bind(this),!1)},this)}removeEventListeners(){this.document&&u.DOM_EVENTS.forEach(function(e){this.document.removeEventListener(e,this.triggerEvent,!1)},this)}triggerEvent(t){this.emit(t.type,t)}addSelectionListeners(){this.document&&this.document.addEventListener('selectionchange',this.onSelectionChange.bind(this),!1)}removeSelectionListeners(){this.document&&this.document.removeEventListener('selectionchange',this.onSelectionChange,!1)}onSelectionChange(){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(function(){var e=this.window.getSelection();this.triggerSelectedEvent(e)}.bind(this),250)}triggerSelectedEvent(e){var t,n;e&&0<e.rangeCount&&(t=e.getRangeAt(0),!t.collapsed&&(n=new d.default(t,this.cfiBase).toString(),this.emit(u.EVENTS.CONTENTS.SELECTED,n),this.emit(u.EVENTS.CONTENTS.SELECTED_RANGE,t)))}range(e,t){var n=new d.default(e);return n.toRange(this.document,t)}cfiFromRange(e,t){return new d.default(e,this.cfiBase,t).toString()}cfiFromNode(e,t){return new d.default(e,this.cfiBase,t).toString()}map(e){var t=new p.default(e);return t.section()}size(e,t){var n={scale:1,scalable:'no'};this.layoutStyle('scrolling'),0<=e&&(this.width(e),n.width=e,this.css('padding','0 '+e/12+'px',!0)),0<=t&&(this.height(t),n.height=t),this.css('margin','0'),this.css('box-sizing','border-box'),this.viewport(n)}columns(e,t,n,i){var a=(0,r.prefixed)('column-axis'),s=(0,r.prefixed)('column-gap'),o=(0,r.prefixed)('column-width'),l=(0,r.prefixed)('column-fill'),d=this.writingMode(),c=0===d.indexOf('vertical')?'vertical':'horizontal';this.layoutStyle('paginated'),'rtl'===this.content.dir&&this.direction('rtl'),this.width(e),this.height(t),this.viewport({width:e,height:t,scale:1,scalable:'no'}),this.css('overflow-y','hidden'),this.css('margin','0',!0),'vertical'==c?this.css('padding',i/2+'px 20px',!0):this.css('padding','20px '+i/2+'px',!0),this.css('box-sizing','border-box'),this.css('max-width','inherit'),this.css(a,'horizontal'),this.css(l,'auto'),this.css(s,i+'px'),this.css(o,n+'px')}scaler(e,t,n){var i='';this.css('transform-origin','top left'),(0<=t||0<=n)&&(i=' translate('+(t||0)+'px, '+(n||0)+'px )'),this.css('transform','scale('+e+')'+i)}fit(e,t){var n=this.viewport(),i=e/parseInt(n.width),a=t/parseInt(n.height),s=i<a?i:a,o=(t-n.height*s)/2;this.layoutStyle('paginated'),this.width(e),this.height(t),this.overflow('hidden'),this.scaler(s,0,o),this.css('background-color','transparent')}direction(e){this.documentElement&&(this.documentElement.style.direction=e)}mapPage(e,t,n,i,a){var s=new p.default(t,a);return s.page(this,e,n,i)}linksHandler(){(0,h.replaceLinks)(this.content,(e)=>{this.emit(u.EVENTS.CONTENTS.LINK_CLICKED,e)})}writingMode(e){var t=(0,r.prefixed)('writing-mode');return e&&this.documentElement&&(this.documentElement.style[t]=e),this.window.getComputedStyle(this.documentElement)[t]||''}layoutStyle(e){return e&&(this._layoutStyle=e,navigator.epubReadingSystem.layoutStyle=this._layoutStyle),this._layoutStyle||'paginated'}epubReadingSystem(e,t){return navigator.epubReadingSystem={name:e,version:t,layoutStyle:this.layoutStyle(),hasFeature:function(e){return'dom-manipulation'===e||'layout-changes'===e||'touch-events'===e||'mouse-events'===e||'keyboard-events'===e||'spine-scripting'!==e&&!1}},navigator.epubReadingSystem}destroy(){this.observer&&this.observer.disconnect(),this.document.removeEventListener('transitionend',this.resizeCheck),this.removeListeners()}}(0,o.default)(f.prototype),t.default=f,e.exports=t['default']},function(e){e.exports=function(e){var t=typeof e;return null!=e&&('object'==t||'function'==t)}},function(t){t.exports=e},function(e){'use strict';var t={application:{ecmascript:['es','ecma'],javascript:'js',ogg:'ogx',pdf:'pdf',postscript:['ps','ai','eps','epsi','epsf','eps2','eps3'],"rdf+xml":'rdf',smil:['smi','smil'],"xhtml+xml":['xhtml','xht'],xml:['xml','xsl','xsd','opf','ncx'],zip:'zip',"x-httpd-eruby":'rhtml',"x-latex":'latex',"x-maker":['frm','maker','frame','fm','fb','book','fbdoc'],"x-object":'o',"x-shockwave-flash":['swf','swfl'],"x-silverlight":'scr',"epub+zip":'epub',"font-tdpfr":'pfr',"inkml+xml":['ink','inkml'],json:'json',"jsonml+json":'jsonml',"mathml+xml":'mathml',"metalink+xml":'metalink',mp4:'mp4s',"omdoc+xml":'omdoc',oxps:'oxps',"vnd.amazon.ebook":'azw',widget:'wgt',"x-dtbook+xml":'dtb',"x-dtbresource+xml":'res',"x-font-bdf":'bdf',"x-font-ghostscript":'gsf',"x-font-linux-psf":'psf',"x-font-otf":'otf',"x-font-pcf":'pcf',"x-font-snf":'snf',"x-font-ttf":['ttf','ttc'],"x-font-type1":['pfa','pfb','pfm','afm'],"x-font-woff":'woff',"x-mobipocket-ebook":['prc','mobi'],"x-mspublisher":'pub',"x-nzb":'nzb',"x-tgif":'obj',"xaml+xml":'xaml',"xml-dtd":'dtd',"xproc+xml":'xpl',"xslt+xml":'xslt',"internet-property-stream":'acx',"x-compress":'z',"x-compressed":'tgz',"x-gzip":'gz'},audio:{flac:'flac',midi:['mid','midi','kar','rmi'],mpeg:['mpga','mpega','mp2','mp3','m4a','mp2a','m2a','m3a'],mpegurl:'m3u',ogg:['oga','ogg','spx'],"x-aiff":['aif','aiff','aifc'],"x-ms-wma":'wma',"x-wav":'wav',adpcm:'adp',mp4:'mp4a',webm:'weba',"x-aac":'aac',"x-caf":'caf',"x-matroska":'mka',"x-pn-realaudio-plugin":'rmp',xm:'xm',mid:['mid','rmi']},image:{gif:'gif',ief:'ief',jpeg:['jpeg','jpg','jpe'],pcx:'pcx',png:'png',"svg+xml":['svg','svgz'],tiff:['tiff','tif'],"x-icon":'ico',bmp:'bmp',webp:'webp',"x-pict":['pic','pct'],"x-tga":'tga',"cis-cod":'cod'},text:{"cache-manifest":['manifest','appcache'],css:'css',csv:'csv',html:['html','htm','shtml','stm'],mathml:'mml',plain:['txt','text','brf','conf','def','list','log','in','bas'],richtext:'rtx',"tab-separated-values":'tsv',"x-bibtex":'bib'},video:{mpeg:['mpeg','mpg','mpe','m1v','m2v','mp2','mpa','mpv2'],mp4:['mp4','mp4v','mpg4'],quicktime:['qt','mov'],ogg:'ogv',"vnd.mpegurl":['mxu','m4u'],"x-flv":'flv',"x-la-asf":['lsf','lsx'],"x-mng":'mng',"x-ms-asf":['asf','asx','asr'],"x-ms-wm":'wm',"x-ms-wmv":'wmv',"x-ms-wmx":'wmx',"x-ms-wvx":'wvx',"x-msvideo":'avi',"x-sgi-movie":'movie',"x-matroska":['mpv','mkv','mk3d','mks'],"3gpp2":'3g2',h261:'h261',h263:'h263',h264:'h264',jpeg:'jpgv',jpm:['jpm','jpgm'],mj2:['mj2','mjp2'],"vnd.ms-playready.media.pyv":'pyv',"vnd.uvvu.mp4":['uvu','uvvu'],"vnd.vivo":'viv',webm:'webm',"x-f4v":'f4v',"x-m4v":'m4v',"x-ms-vob":'vob',"x-smv":'smv'}},n=function(){var e={},n,i,a,s;for(n in t)if(t.hasOwnProperty(n))for(i in t[n])if(t[n].hasOwnProperty(i))if(a=t[n][i],'string'==typeof a)e[a]=n+'/'+i;else for(s=0;s<a.length;s++)e[a[s]]=n+'/'+i;return e}();e.exports={lookup:function(e){return e&&n[e.split('.').pop().toLowerCase()]||'text/plain'}}},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0});var a=n(2),s=i(a),o=n(0),r=n(10),l=i(r),d=n(1),c=i(d),p=n(12),h=i(p),u=n(48),g=i(u),m=n(49),f=i(m),y=n(13),b=i(y),x=n(50),v=i(x),E=n(3);class _{constructor(e,t){this.settings=(0,o.extend)(this.settings||{},{width:null,height:null,ignoreClass:'',manager:'default',view:'iframe',flow:null,layout:null,spread:null,minSpreadWidth:800,stylesheet:null,script:null}),(0,o.extend)(this.settings,t),'object'==typeof this.settings.manager&&(this.manager=this.settings.manager),this.book=e,this.hooks={},this.hooks.display=new l.default(this),this.hooks.serialize=new l.default(this),this.hooks.content=new l.default(this),this.hooks.unloaded=new l.default(this),this.hooks.layout=new l.default(this),this.hooks.render=new l.default(this),this.hooks.show=new l.default(this),this.hooks.content.register(this.handleLinks.bind(this)),this.hooks.content.register(this.passEvents.bind(this)),this.hooks.content.register(this.adjustImages.bind(this)),this.book.spine.hooks.content.register(this.injectIdentifier.bind(this)),this.settings.stylesheet&&this.book.spine.hooks.content.register(this.injectStylesheet.bind(this)),this.settings.script&&this.book.spine.hooks.content.register(this.injectScript.bind(this)),this.themes=new f.default(this),this.annotations=new v.default(this),this.epubcfi=new c.default,this.q=new h.default(this),this.location=void 0,this.q.enqueue(this.book.opened),this.starting=new o.defer,this.started=this.starting.promise,this.q.enqueue(this.start)}setManager(e){this.manager=e}requireManager(e){var t;return t='string'==typeof e&&'undefined'!=typeof ePub?ePub.ViewManagers[e]:e,t}requireView(e){var t;return t='string'==typeof e&&'undefined'!=typeof ePub?ePub.Views[e]:e,t}start(){this.manager||(this.ViewManager=this.requireManager(this.settings.manager),this.View=this.requireView(this.settings.view),this.manager=new this.ViewManager({view:this.View,queue:this.q,request:this.book.load.bind(this.book),settings:this.settings})),this.direction(this.book.package.metadata.direction),this.settings.globalLayoutProperties=this.determineLayoutProperties(this.book.package.metadata),this.flow(this.settings.globalLayoutProperties.flow),this.layout(this.settings.globalLayoutProperties),this.manager.on(E.EVENTS.MANAGERS.ADDED,this.afterDisplayed.bind(this)),this.manager.on(E.EVENTS.MANAGERS.REMOVED,this.afterRemoved.bind(this)),this.manager.on(E.EVENTS.MANAGERS.RESIZED,this.onResized.bind(this)),this.manager.on(E.EVENTS.MANAGERS.ORIENTATION_CHANGE,this.onOrientationChange.bind(this)),this.manager.on(E.EVENTS.MANAGERS.SCROLLED,this.reportLocation.bind(this)),this.emit(E.EVENTS.RENDITION.STARTED),this.starting.resolve()}attachTo(e){return this.q.enqueue(function(){this.manager.render(e,{width:this.settings.width,height:this.settings.height}),this.emit(E.EVENTS.RENDITION.ATTACHED)}.bind(this))}display(e){return this.displaying&&this.displaying.resolve(),this.q.enqueue(this._display,e)}_display(e){if(this.book){var t=this.epubcfi.isCfiString(e),n=new o.defer,i=n.promise,a;return(this.displaying=n,this.book.locations.length()&&((0,o.isFloat)(e)||'1.0'===e)&&(e=this.book.locations.cfiFromPercentage(parseFloat(e))),a=this.book.spine.get(e),!a)?(n.reject(new Error('No Section Found')),i):(this.manager.display(a,e).then(()=>{n.resolve(a),this.displaying=void 0,this.emit(E.EVENTS.RENDITION.DISPLAYED,a),this.reportLocation()},(e)=>{this.emit(E.EVENTS.RENDITION.DISPLAY_ERROR,e)}),i)}}afterDisplayed(e){e.on(E.EVENTS.VIEWS.MARK_CLICKED,(t,n)=>this.triggerMarkEvent(t,n,e)),this.hooks.render.trigger(e,this).then(()=>{e.contents?this.hooks.content.trigger(e.contents,this).then(()=>{this.emit(E.EVENTS.RENDITION.RENDERED,e.section,e)}):this.emit(E.EVENTS.RENDITION.RENDERED,e.section,e)})}afterRemoved(e){this.hooks.unloaded.trigger(e,this).then(()=>{this.emit(E.EVENTS.RENDITION.REMOVED,e.section,e)})}onResized(e){this.emit(E.EVENTS.RENDITION.RESIZED,{width:e.width,height:e.height}),this.location&&this.location.start&&this.display(this.location.start.cfi)}onOrientationChange(e){this.emit(E.EVENTS.RENDITION.ORIENTATION_CHANGE,e)}moveTo(e){this.manager.moveTo(e)}resize(e,t){e&&(this.settings.width=e),t&&(this.settings.height=e),this.manager.resize(e,t)}clear(){this.manager.clear()}next(){return this.q.enqueue(this.manager.next.bind(this.manager)).then(this.reportLocation.bind(this))}prev(){return this.q.enqueue(this.manager.prev.bind(this.manager)).then(this.reportLocation.bind(this))}determineLayoutProperties(e){var t=this.settings.layout||e.layout||'reflowable',n=this.settings.spread||e.spread||'auto',i=this.settings.orientation||e.orientation||'auto',a=this.settings.flow||e.flow||'auto',s=e.viewport||'',o=this.settings.minSpreadWidth||e.minSpreadWidth||800,r=this.settings.direction||e.direction||'ltr',l;return(0===this.settings.width||0<this.settings.width)&&(0===this.settings.height||0<this.settings.height),l={layout:t,spread:n,orientation:i,flow:a,viewport:s,minSpreadWidth:o,direction:r},l}flow(e){var t=e;('scrolled'===e||'scrolled-doc'===e||'scrolled-continuous'===e)&&(t='scrolled'),('auto'===e||'paginated'===e)&&(t='paginated'),this.settings.flow=e,this._layout&&this._layout.flow(t),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this.manager&&this.manager.updateFlow(t),this.manager&&this.manager.isRendered()&&this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}layout(e){return e&&(this._layout=new g.default(e),this._layout.spread(e.spread,this.settings.minSpreadWidth),this._layout.on(E.EVENTS.LAYOUT.UPDATED,(e,t)=>{this.emit(E.EVENTS.RENDITION.LAYOUT,e,t)})),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this._layout}spread(e,t){this._layout.spread(e,t),this.manager.isRendered()&&this.manager.updateLayout()}direction(e){this.settings.direction=e||'ltr',this.manager&&this.manager.direction(this.settings.direction),this.manager&&this.manager.isRendered()&&this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}reportLocation(){return this.q.enqueue(function(){requestAnimationFrame(function(){var e=this.manager.currentLocation();if(e&&e.then&&'function'==typeof e.then)e.then(function(e){var t=this.located(e);t&&t.start&&t.end&&(this.location=t,this.emit(E.EVENTS.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit(E.EVENTS.RENDITION.RELOCATED,this.location))}.bind(this));else if(e){var t=this.located(e);if(!t||!t.start||!t.end)return;this.location=t,this.emit(E.EVENTS.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit(E.EVENTS.RENDITION.RELOCATED,this.location)}}.bind(this))}.bind(this))}currentLocation(){var e=this.manager.currentLocation();if(e&&e.then&&'function'==typeof e.then)e.then(function(e){var t=this.located(e);return t}.bind(this));else if(e){var t=this.located(e);return t}}located(e){if(!e.length)return{};var t=e[0],n=e[e.length-1],i={start:{index:t.index,href:t.href,cfi:t.mapping.start,displayed:{page:t.pages[0]||1,total:t.totalPages}},end:{index:n.index,href:n.href,cfi:n.mapping.end,displayed:{page:n.pages[n.pages.length-1]||1,total:n.totalPages}}},a=this.book.locations.locationFromCfi(t.mapping.start),s=this.book.locations.locationFromCfi(n.mapping.end);null!=a&&(i.start.location=a,i.start.percentage=this.book.locations.percentageFromLocation(a)),null!=s&&(i.end.location=s,i.end.percentage=this.book.locations.percentageFromLocation(s));var o=this.book.pageList.pageFromCfi(t.mapping.start),r=this.book.pageList.pageFromCfi(n.mapping.end);return-1!=o&&(i.start.page=o),-1!=r&&(i.end.page=r),n.index===this.book.spine.last().index&&i.end.displayed.page>=i.end.displayed.total&&(i.atEnd=!0),t.index===this.book.spine.first().index&&1===i.start.displayed.page&&(i.atStart=!0),i}destroy(){this.manager&&this.manager.destroy(),this.book=void 0}passEvents(t){var e=b.default.listenedEvents;e.forEach((n)=>{t.on(n,(e)=>this.triggerViewEvent(e,t))}),t.on(E.EVENTS.CONTENTS.SELECTED,(n)=>this.triggerSelectedEvent(n,t))}triggerViewEvent(t,e){this.emit(t.type,t,e)}triggerSelectedEvent(e,t){this.emit(E.EVENTS.RENDITION.SELECTED,e,t)}triggerMarkEvent(e,t,n){this.emit(E.EVENTS.RENDITION.MARK_CLICKED,e,t,n)}getRange(e,t){var n=new c.default(e),i=this.manager.visible().filter(function(e){if(n.spinePos===e.index)return!0});if(i.length)return i[0].contents.range(n,t)}adjustImages(e){return'pre-paginated'===this._layout.name?new Promise(function(e){e()}):(e.addStylesheetRules({img:{"max-width":(this._layout.columnWidth?this._layout.columnWidth+'px':'100%')+'!important',"max-height":(this._layout.height?0.6*this._layout.height+'px':'60%')+'!important',"object-fit":'contain',"page-break-inside":'avoid'},svg:{"max-width":(this._layout.columnWidth?this._layout.columnWidth+'px':'100%')+'!important',"max-height":(this._layout.height?0.6*this._layout.height+'px':'60%')+'!important',"page-break-inside":'avoid'}}),new Promise(function(e){setTimeout(function(){e()},1)}))}getContents(){return this.manager?this.manager.getContents():[]}views(){var e=this.manager?this.manager.views:void 0;return e||[]}handleLinks(e){e&&e.on(E.EVENTS.CONTENTS.LINK_CLICKED,(e)=>{var t=this.book.path.relative(e);this.display(t)})}injectStylesheet(e){var t=e.createElement('link');t.setAttribute('type','text/css'),t.setAttribute('rel','stylesheet'),t.setAttribute('href',this.settings.stylesheet),e.getElementsByTagName('head')[0].appendChild(t)}injectScript(e){var t=e.createElement('script');t.setAttribute('type','text/javascript'),t.setAttribute('src',this.settings.script),t.textContent=' ',e.getElementsByTagName('head')[0].appendChild(t)}injectIdentifier(e){var t=this.book.package.metadata.identifier,n=e.createElement('meta');n.setAttribute('name','dc.relation.ispartof'),t&&n.setAttribute('content',t),e.getElementsByTagName('head')[0].appendChild(n)}}(0,s.default)(_.prototype),t.default=_,e.exports=t['default']},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var s=n(1),o=function(e){return e&&e.__esModule?e:{default:e}}(s);t.default=class{constructor(e,t,n,i){this.layout=e,this.horizontal=!('horizontal'!==n),this.direction=t||'ltr',this._dev=i}section(e){var t=this.findRanges(e),n=this.rangeListToCfiList(e.section.cfiBase,t);return n}page(e,t,n,i){var a=e&&e.document&&e.document.body,s;if(a){if(s=this.rangePairToCfiPair(t,{start:this.findStart(a,n,i),end:this.findEnd(a,n,i)}),!0===this._dev){var l=e.document,d=new o.default(s.start).toRange(l),c=new o.default(s.end).toRange(l),p=l.defaultView.getSelection(),h=l.createRange();p.removeAllRanges(),h.setStart(d.startContainer,d.startOffset),h.setEnd(c.endContainer,c.endOffset),p.addRange(h)}return s}}walk(e,t){if(!(e&&e.nodeType===Node.TEXT_NODE)){var n={acceptNode:function(e){return 0<e.data.trim().length?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},i=n.acceptNode;i.acceptNode=n.acceptNode;for(var a=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,i,!1),s,o;(s=a.nextNode())&&(o=t(s),!o););return o}}findRanges(e){for(var t=[],n=e.contents.scrollWidth(),s=a(n/this.layout.spreadWidth),o=s*this.layout.divisor,r=this.layout.columnWidth,l=this.layout.gap,d=0,i,c;d<o.pages;d++)i=(r+l)*d,c=r*(d+1)+l*d,t.push({start:this.findStart(e.document.body,i,c),end:this.findEnd(e.document.body,i,c)});return t}findStart(e,t,n){for(var i=[e],a=e,s,o;i.length;)if(s=i.shift(),o=this.walk(s,(e)=>{var s,o,r,l,d;if(d=this.getBounds(e),this.horizontal&&'ltr'===this.direction){if(s=this.horizontal?d.left:d.top,o=this.horizontal?d.right:d.bottom,s>=t&&s<=n)return e;if(o>t)return e;a=e,i.push(e)}else if(this.horizontal&&'rtl'===this.direction){if(s=d.left,o=d.right,o<=n&&o>=t)return e;if(s<n)return e;a=e,i.push(e)}else{if(r=d.top,l=d.bottom,r>=t&&r<=n)return e;if(l>t)return e;a=e,i.push(e)}}),o)return this.findTextStartRange(o,t,n);return this.findTextStartRange(a,t,n)}findEnd(e,t,n){for(var a=[e],s=e,o,r;a.length;)if(o=a.shift(),r=this.walk(o,(e)=>{var o,r,l,d,c;if(c=this.getBounds(e),this.horizontal&&'ltr'===this.direction){if(o=i(c.left),r=i(c.right),o>n&&s)return s;if(r>n)return e;s=e,a.push(e)}else if(this.horizontal&&'rtl'===this.direction){if(o=i(this.horizontal?c.left:c.top),r=i(this.horizontal?c.right:c.bottom),r<t&&s)return s;if(o<t)return e;s=e,a.push(e)}else{if(l=i(c.top),d=i(c.bottom),l>n&&s)return s;if(d>n)return e;s=e,a.push(e)}}),r)return this.findTextEndRange(r,t,n);return this.findTextEndRange(s,t,n)}findTextStartRange(e,t,n){for(var a=this.splitTextNodeIntoRanges(e),s=0,i,o,r,l,d;s<a.length;s++)if(i=a[s],o=i.getBoundingClientRect(),this.horizontal&&'ltr'===this.direction){if(r=o.left,r>=t)return i;}else if(this.horizontal&&'rtl'===this.direction){if(d=o.right,d<=n)return i;}else if(l=o.top,l>=t)return i;return a[0]}findTextEndRange(e,t,n){for(var a=this.splitTextNodeIntoRanges(e),s=0,i,o,r,l,d,c,p;s<a.length;s++){if(o=a[s],r=o.getBoundingClientRect(),this.horizontal&&'ltr'===this.direction){if(l=r.left,d=r.right,l>n&&i)return i;if(d>n)return o}else if(this.horizontal&&'rtl'===this.direction){if(l=r.left,d=r.right,d<t&&i)return i;if(l<t)return o}else{if(c=r.top,p=r.bottom,c>n&&i)return i;if(p>n)return o}i=o}return a[a.length-1]}splitTextNodeIntoRanges(e,t){var n=[],i=e.textContent||'',a=i.trim(),s=e.ownerDocument,o=t||' ',r=a.indexOf(o),l;if(-1===r||e.nodeType!=Node.TEXT_NODE)return l=s.createRange(),l.selectNodeContents(e),[l];for(l=s.createRange(),l.setStart(e,0),l.setEnd(e,r),n.push(l),l=!1;-1!=r;)r=a.indexOf(o,r+1),0<r&&(l&&(l.setEnd(e,r),n.push(l)),l=s.createRange(),l.setStart(e,r+1));return l&&(l.setEnd(e,a.length),n.push(l)),n}rangePairToCfiPair(e,t){var n=t.start,i=t.end;n.collapse(!0),i.collapse(!1);var a=new o.default(n,e).toString(),s=new o.default(i,e).toString();return{start:a,end:s}}rangeListToCfiList(e,t){for(var n=[],a=0,i;a<t.length;a++)i=this.rangePairToCfiPair(e,t[a]),n.push(i);return n}getBounds(e){var t;if(e.nodeType==Node.TEXT_NODE){var n=document.createRange();n.selectNodeContents(e),t=n.getBoundingClientRect()}else t=e.getBoundingClientRect();return t}axis(e){return e&&(this.horizontal='horizontal'===e),this.horizontal}},e.exports=t['default']},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0});var s=n(2),r=i(s),l=n(0),d=n(18),c=i(d),p=n(12),h=i(p),u=n(58),g=i(u),m=n(68),f=i(m),y=n(3);class b{constructor(e){this.name='default',this.View=e.view,this.request=e.request,this.renditionQueue=e.queue,this.q=new h.default(this),this.settings=(0,l.extend)(this.settings||{},{infinite:!0,hidden:!1,width:void 0,height:void 0,axis:void 0,flow:'scrolled',ignoreClass:''}),(0,l.extend)(this.settings,e.settings||{}),this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,flow:this.settings.flow,layout:this.layout,method:this.settings.method,width:0,height:0,forceEvenPages:!0},this.rendered=!1}render(e,t){var n=e.tagName;n&&('body'==n.toLowerCase()||'html'==n.toLowerCase())&&(this.fullsize=!0),this.fullsize&&(this.settings.overflow='visible',this.overflow=this.settings.overflow),this.settings.size=t,this.stage=new g.default({width:t.width,height:t.height,overflow:this.overflow,hidden:this.settings.hidden,axis:this.settings.axis,fullsize:this.fullsize,direction:this.settings.direction}),this.stage.attachTo(e),this.container=this.stage.getContainer(),this.views=new f.default(this.container),this._bounds=this.bounds(),this._stageSize=this.stage.size(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.stage.onResize(this.onResized.bind(this)),this.stage.onOrientationChange(this.onOrientationChange.bind(this)),this.addEventListeners(),this.layout&&this.updateLayout(),this.rendered=!0}addEventListeners(){var e;window.addEventListener('unload',function(){this.destroy()}.bind(this)),e=this.fullsize?window:this.container,e.addEventListener('scroll',this.onScroll.bind(this))}removeEventListeners(){var e;e=this.fullsize?window:this.container,e.removeEventListener('scroll',this.onScroll.bind(this))}destroy(){clearTimeout(this.orientationTimeout),clearTimeout(this.resizeTimeout),clearTimeout(this.afterScrolled),this.clear(),this.removeEventListeners(),this.stage.destroy(),this.rendered=!1}onOrientationChange(){var e=window,t=e.orientation;this.resize(),clearTimeout(this.orientationTimeout),this.orientationTimeout=setTimeout(function(){this.orientationTimeout=void 0,this.resize(),this.emit(y.EVENTS.MANAGERS.ORIENTATION_CHANGE,t)}.bind(this),500)}onResized(){this.resize()}resize(e,t){var n=this.stage.size(e,t);return this.winBounds=(0,l.windowBounds)(),this.orientationTimeout&&this.winBounds.width===this.winBounds.height?void(this._stageSize=void 0):void(this._stageSize&&this._stageSize.width===n.width&&this._stageSize.height===n.height||(this._stageSize=n,this._bounds=this.bounds(),this.clear(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.updateLayout(),this.emit(y.EVENTS.MANAGERS.RESIZED,{width:this._stageSize.width,height:this._stageSize.height})))}createView(e){return new this.View(e,this.viewSettings)}display(e,t){var n=new l.defer,i=n.promise;(t===e.href||(0,l.isNumber)(t))&&(t=void 0);var a=this.views.find(e);if(a&&e){var s=a.offset();if('ltr'===this.settings.direction)this.scrollTo(s.left,s.top,!0);else{var o=a.width();this.scrollTo(s.left+o,s.top,!0)}if(t){var r=a.locationOf(t);this.moveTo(r)}return n.resolve(),i}return this.clear(),this.add(e).then(function(e){if(t){var n=e.locationOf(t);this.moveTo(n)}}.bind(this),(e)=>{n.reject(e)}).then(function(){var t;if('pre-paginated'===this.layout.name&&1<this.layout.divisor&&(t=e.next(),t))return this.add(t)}.bind(this)).then(function(){this.views.show(),n.resolve()}.bind(this)),i}afterDisplayed(e){this.emit(y.EVENTS.MANAGERS.ADDED,e)}afterResized(e){this.emit(y.EVENTS.MANAGERS.RESIZE,e.section)}moveTo(e){var t=0,n=0;this.isPaginated?(t=o(e.left/this.layout.delta)*this.layout.delta,t+this.layout.delta>this.container.scrollWidth&&(t=this.container.scrollWidth-this.layout.delta)):n=e.top,this.scrollTo(t,n,!0)}add(e){var t=this.createView(e);return this.views.append(t),t.onDisplayed=this.afterDisplayed.bind(this),t.onResize=this.afterResized.bind(this),t.on(y.EVENTS.VIEWS.AXIS,(e)=>{this.updateAxis(e)}),t.display(this.request)}append(e){var t=this.createView(e);return this.views.append(t),t.onDisplayed=this.afterDisplayed.bind(this),t.onResize=this.afterResized.bind(this),t.on(y.EVENTS.VIEWS.AXIS,(e)=>{this.updateAxis(e)}),t.display(this.request)}prepend(e){var t=this.createView(e);return t.on(y.EVENTS.VIEWS.RESIZED,(e)=>{this.counter(e)}),this.views.prepend(t),t.onDisplayed=this.afterDisplayed.bind(this),t.onResize=this.afterResized.bind(this),t.on(y.EVENTS.VIEWS.AXIS,(e)=>{this.updateAxis(e)}),t.display(this.request)}counter(e){'vertical'===this.settings.axis?this.scrollBy(0,e.heightDelta,!0):this.scrollBy(e.widthDelta,0,!0)}next(){var e=this.settings.direction,t,n;if(this.views.length){if(this.isPaginated&&'horizontal'===this.settings.axis&&(!e||'ltr'===e))this.scrollLeft=this.container.scrollLeft,n=this.container.scrollLeft+this.container.offsetWidth+this.layout.delta,n<=this.container.scrollWidth?this.scrollBy(this.layout.delta,0,!0):t=this.views.last().section.next();else if(this.isPaginated&&'horizontal'===this.settings.axis&&'rtl'===e)this.scrollLeft=this.container.scrollLeft,n=this.container.scrollLeft,0<n?this.scrollBy(this.layout.delta,0,!0):t=this.views.last().section.next();else if(this.isPaginated&&'vertical'===this.settings.axis){this.scrollTop=this.container.scrollTop;var i=this.container.scrollTop+this.container.offsetHeight;i<this.container.scrollHeight?this.scrollBy(0,this.layout.height,!0):t=this.views.last().section.next()}else t=this.views.last().section.next();return t?(this.clear(),this.append(t).then(function(){var e;if('pre-paginated'===this.layout.name&&1<this.layout.divisor&&(e=t.next(),e))return this.append(e)}.bind(this),(e)=>{displaying.reject(e)}).then(function(){this.views.show()}.bind(this))):void 0}}prev(){var e=this.settings.direction,t,n;if(this.views.length){if(this.isPaginated&&'horizontal'===this.settings.axis&&(!e||'ltr'===e))this.scrollLeft=this.container.scrollLeft,n=this.container.scrollLeft,0<n?this.scrollBy(-this.layout.delta,0,!0):t=this.views.first().section.prev();else if(this.isPaginated&&'horizontal'===this.settings.axis&&'rtl'===e)this.scrollLeft=this.container.scrollLeft,n=this.container.scrollLeft+this.container.offsetWidth+this.layout.delta,n<=this.container.scrollWidth?this.scrollBy(-this.layout.delta,0,!0):t=this.views.first().section.prev();else if(this.isPaginated&&'vertical'===this.settings.axis){this.scrollTop=this.container.scrollTop;var i=this.container.scrollTop;0<i?this.scrollBy(0,-this.layout.height,!0):t=this.views.first().section.prev()}else t=this.views.first().section.prev();return t?(this.clear(),this.prepend(t).then(function(){var e;if('pre-paginated'===this.layout.name&&1<this.layout.divisor&&(e=t.prev(),e))return this.prepend(e)}.bind(this),(e)=>{displaying.reject(e)}).then(function(){this.isPaginated&&'horizontal'===this.settings.axis&&('rtl'===this.settings.direction?this.scrollTo(0,0,!0):this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0)),this.views.show()}.bind(this))):void 0}}current(){var e=this.visible();return e.length?e[e.length-1]:null}clear(){this.views&&(this.views.hide(),this.scrollTo(0,0,!0),this.views.clear())}currentLocation(){return this.location='vertical'===this.settings.axis?this.scrolledLocation():this.paginatedLocation(),this.location}scrolledLocation(){var e=this.visible(),t=this.container.getBoundingClientRect(),n=t.height<window.innerHeight?t.height:window.innerHeight,s=0,o=0;this.fullsize&&(s=window.scrollY);var i=e.map((e)=>{var r=e.section,l=r.index,d=r.href,c=e.position(),p=e.height(),h=s+t.top-c.top+o,u=h+n-o;u>p&&(u=p,o=u-h);var g=this.layout.count(p,n).pages,m=a(h/n),f=[],y=a(u/n);f=[];for(var b=m,i;b<=y;b++)i=b+1,f.push(i);var x=this.mapping.page(e.contents,e.section.cfiBase,h,u);return{index:l,href:d,pages:f,totalPages:g,mapping:x}});return i}paginatedLocation(){var e=this.visible(),t=this.container.getBoundingClientRect(),n=0,a=0;this.fullsize&&(n=window.scrollX);var i=e.map((e)=>{var s=e.section,r=s.index,l=s.href,d=e.offset().left,c=e.position().left,p=e.width(),h=n+t.left-c+a,u=h+this.layout.width-a,g=this.mapping.page(e.contents,e.section.cfiBase,h,u),m=this.layout.count(p).pages,f=o(h/this.layout.pageWidth),y=[],b=o(u/this.layout.pageWidth);if(0>f&&(f=0,++b),'rtl'===this.settings.direction){var x=f;f=m-b,b=m-x}for(var v=f+1,i;v<=b;v++)i=v,y.push(i);return{index:r,href:l,pages:y,totalPages:m,mapping:g}});return i}isVisible(e,t,n,i){var a=e.position(),s=i||this.bounds();if('horizontal'===this.settings.axis&&a.right>s.left-t&&a.left<s.right+n)return!0;return'vertical'===this.settings.axis&&a.bottom>s.top-t&&a.top<s.bottom+n}visible(){for(var e=this.bounds(),t=this.views.displayed(),n=t.length,a=[],s=0,i,o;s<n;s++)o=t[s],i=this.isVisible(o,0,0,e),!0===i&&a.push(o);return a}scrollBy(e,t,n){var i='rtl'===this.settings.direction?-1:1;n&&(this.ignore=!0),this.fullsize?window.scrollBy(e*i,t*i):(e&&(this.container.scrollLeft+=e*i),t&&(this.container.scrollTop+=t)),this.scrolled=!0}scrollTo(e,t,n){n&&(this.ignore=!0),this.fullsize?window.scrollTo(e,t):(this.container.scrollLeft=e,this.container.scrollTop=t),this.scrolled=!0}onScroll(){var e,t;this.fullsize?(e=window.scrollY,t=window.scrollX):(e=this.container.scrollTop,t=this.container.scrollLeft),this.scrollTop=e,this.scrollLeft=t,this.ignore?this.ignore=!1:(this.emit(y.EVENTS.MANAGERS.SCROLL,{top:e,left:t}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.emit(y.EVENTS.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft})}.bind(this),20))}bounds(){var e;return e=this.stage.bounds(),e}applyLayout(e){this.layout=e,this.updateLayout()}updateLayout(){this.stage&&(this._stageSize=this.stage.size(),this.isPaginated?(this.layout.calculate(this._stageSize.width,this._stageSize.height,this.settings.gap),this.settings.offset=this.layout.delta):this.layout.calculate(this._stageSize.width,this._stageSize.height),this.viewSettings.width=this.layout.width,this.viewSettings.height=this.layout.height,this.setLayout(this.layout))}setLayout(e){this.viewSettings.layout=e,this.mapping=new c.default(e.props,this.settings.direction,this.settings.axis),this.views&&this.views.forEach(function(t){t&&t.setLayout(e)})}updateAxis(e,t){this.isPaginated||(e='vertical');(t||e!==this.settings.axis)&&(this.settings.axis=e,this.stage&&this.stage.axis(e),this.viewSettings.axis=e,this.mapping&&(this.mapping=new c.default(this.layout.props,this.settings.direction,this.settings.axis)),this.layout&&'vertical'===e?this.layout.spread('none'):this.layout.spread(this.layout.settings.spread))}updateFlow(e){var t='paginated'===e||'auto'===e;this.isPaginated=t,('scrolled-doc'===e||'scrolled-continuous'===e||'scrolled'===e)&&this.updateAxis('vertical'),this.viewSettings.flow=e,this.overflow=this.settings.overflow?this.settings.overflow:t?'hidden':'auto',this.updateLayout()}getContents(){var e=[];return this.views?(this.views.forEach(function(t){var n=t&&t.contents;n&&e.push(n)}),e):e}direction(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:'ltr';this.settings.direction=e,this.stage&&this.stage.direction(e),this.viewSettings.direction=e,this.updateLayout()}isRendered(){return this.rendered}}(0,r.default)(b.prototype),t.default=b,e.exports=t['default']},function(e,t,n){var i=n(14),a=n(60),o=n(62),r=Math.min;e.exports=function(e,t,n){function l(t){var n=x,i=v;return x=v=void 0,m=t,_=e.apply(i,n),_}function d(e){return m=e,w=setTimeout(h,t),f?l(e):_}function c(e){var n=e-S,i=e-m,a=t-n;return y?r(a,E-i):a}function p(e){var n=e-S,i=e-m;return void 0==S||n>=t||0>n||y&&i>=E}function h(){var e=a();return p(e)?u(e):void(w=setTimeout(h,c(e)))}function u(e){return(w=void 0,b&&x)?l(e):(x=v=void 0,_)}function g(){var e=a(),n=p(e);if(x=arguments,v=this,S=e,n){if(void 0===w)return d(S);if(y)return w=setTimeout(h,t),l(S)}return void 0===w&&(w=setTimeout(h,t)),_}var m=0,f=!1,y=!1,b=!0,x,v,E,_,w,S;if('function'!=typeof e)throw new TypeError('Expected a function');return t=o(t)||0,i(n)&&(f=!!n.leading,y='maxWait'in n,E=y?s(o(n.maxWait)||0,t):E,b='trailing'in n?!!n.trailing:b),g.cancel=function(){void 0!==w&&clearTimeout(w),m=0,x=S=v=w=void 0},g.flush=function(){return void 0===w?_:u(a())},g}},function(e,t,n){var i=n(61),a='object'==typeof self&&self&&self.Object===Object&&self,s=i||a||Function('return this')();e.exports=s},function(e,t,n){var i=n(21),a=i.Symbol;e.exports=a},function(e,t,n){'use strict';(function(i){function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return new r.default(e,t)}Object.defineProperty(t,'__esModule',{value:!0});var o=n(24),r=a(o),l=n(17),d=a(l),c=n(1),p=a(c),h=n(13),u=a(h),g=n(0),m=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(g);n(53);var f=n(54),y=a(f),b=n(19),x=a(b),v=n(69),E=a(v);s.VERSION='0.3','undefined'!=typeof i&&(i.EPUBJS_VERSION=s.VERSION),s.CFI=p.default,s.Rendition=d.default,s.Contents=u.default,s.utils=m,s.ViewManagers={},s.Views={},s.register={manager:function(e,t){return s.ViewManagers[e]=t},view:function(e,t){return s.Views[e]=t}},s.register.view('iframe',y.default),s.register.manager('default',x.default),s.register.manager('continuous',E.default),t.default=s,e.exports=t['default']}).call(t,n(8))},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0});var a=n(2),s=i(a),o=n(0),r=n(5),l=i(r),d=n(4),c=i(d),p=n(40),h=i(p),u=n(42),g=i(u),m=n(43),f=i(m),y=n(44),b=i(y),x=n(45),v=i(x),E=n(46),_=i(E),w=n(47),S=i(w),C=n(17),N=i(C),T=n(51),k=i(T),R=n(11),L=i(R),A=n(1),I=i(A),O=n(3),P='META-INF/container.xml',D={BINARY:'binary',BASE64:'base64',EPUB:'epub',OPF:'opf',MANIFEST:'json',DIRECTORY:'directory'};class z{constructor(e,t){'undefined'==typeof t&&'object'==typeof e&&(t=e,e=void 0),this.settings=(0,o.extend)(this.settings||{},{requestMethod:void 0,requestCredentials:void 0,requestHeaders:void 0,encoding:void 0,replacements:void 0,canonical:void 0}),(0,o.extend)(this.settings,t),this.opening=new o.defer,this.opened=this.opening.promise,this.isOpen=!1,this.loading={manifest:new o.defer,spine:new o.defer,metadata:new o.defer,cover:new o.defer,navigation:new o.defer,pageList:new o.defer,resources:new o.defer},this.loaded={manifest:this.loading.manifest.promise,spine:this.loading.spine.promise,metadata:this.loading.metadata.promise,cover:this.loading.cover.promise,navigation:this.loading.navigation.promise,pageList:this.loading.pageList.promise,resources:this.loading.resources.promise},this.ready=Promise.all([this.loaded.manifest,this.loaded.spine,this.loaded.metadata,this.loaded.cover,this.loaded.navigation,this.loaded.resources]),this.isRendered=!1,this.request=this.settings.requestMethod||L.default,this.spine=new h.default,this.locations=new g.default(this.spine,this.load.bind(this)),this.navigation=void 0,this.pageList=void 0,this.url=void 0,this.path=void 0,this.archived=!1,this.archive=void 0,this.resources=void 0,this.rendition=void 0,this.container=void 0,this.packaging=void 0,e&&this.open(e).catch(()=>{var t=new Error('Cannot load book at '+e);this.emit(O.EVENTS.BOOK.OPEN_FAILED,t)})}open(e,t){var n=t||this.determineType(e),i;return n===D.BINARY?(this.archived=!0,this.url=new l.default('/',''),i=this.openEpub(e)):n===D.BASE64?(this.archived=!0,this.url=new l.default('/',''),i=this.openEpub(e,n)):n===D.EPUB?(this.archived=!0,this.url=new l.default('/',''),i=this.request(e,'binary').then(this.openEpub.bind(this))):n==D.OPF?(this.url=new l.default(e),i=this.openPackaging(this.url.Path.toString())):n==D.MANIFEST?(this.url=new l.default(e),i=this.openManifest(this.url.Path.toString())):(this.url=new l.default(e),i=this.openContainer(P).then(this.openPackaging.bind(this))),i}openEpub(e,t){return this.unarchive(e,t||this.settings.encoding).then(()=>{return this.openContainer(P)}).then((e)=>{return this.openPackaging(e)})}openContainer(e){return this.load(e).then((e)=>{return this.container=new f.default(e),this.resolve(this.container.packagePath)})}openPackaging(e){return this.path=new c.default(e),this.load(e).then((e)=>{return this.packaging=new b.default(e),this.unpack(this.packaging)})}openManifest(e){return this.path=new c.default(e),this.load(e).then((e)=>{return this.packaging=new b.default,this.packaging.load(e),this.unpack(this.packaging)})}load(e){var t;return this.archived?(t=this.resolve(e),this.archive.request(t)):(t=this.resolve(e),this.request(t,null,this.settings.requestCredentials,this.settings.requestHeaders))}resolve(e,t){if(e){var n=e,i=-1<e.indexOf('://');return i?e:(this.path&&(n=this.path.resolve(e)),!1!=t&&this.url&&(n=this.url.resolve(n)),n)}}canonical(e){var t=e;return e?(t=this.settings.canonical?this.settings.canonical(e):this.resolve(e,!0),t):''}determineType(e){var t,n,i;return'base64'===this.settings.encoding?D.BASE64:'string'==typeof e?(t=new l.default(e),n=t.path(),i=n.extension,i?'epub'===i?D.EPUB:'opf'===i?D.OPF:'json'===i?D.MANIFEST:void 0:D.DIRECTORY):D.BINARY}unpack(e){this.package=e,this.spine.unpack(this.package,this.resolve.bind(this),this.canonical.bind(this)),this.resources=new _.default(this.package.manifest,{archive:this.archive,resolver:this.resolve.bind(this),request:this.request.bind(this),replacements:this.settings.replacements||(this.archived?'blobUrl':'base64')}),this.loadNavigation(this.package).then(()=>{this.loading.navigation.resolve(this.navigation)}),this.package.coverPath&&(this.cover=this.resolve(this.package.coverPath)),this.loading.manifest.resolve(this.package.manifest),this.loading.metadata.resolve(this.package.metadata),this.loading.spine.resolve(this.spine),this.loading.cover.resolve(this.cover),this.loading.resources.resolve(this.resources),this.loading.pageList.resolve(this.pageList),this.isOpen=!0,this.archived||this.settings.replacements&&'none'!=this.settings.replacements?this.replacements().then(()=>{this.opening.resolve(this)}).catch((e)=>{console.error(e)}):this.opening.resolve(this)}loadNavigation(e){var t=e.navPath||e.ncxPath,n=e.toc;return n?new Promise((t)=>{this.navigation=new v.default(n),e.pageList&&(this.pageList=new S.default(e.pageList)),t(this.navigation)}):t?this.load(t,'xml').then((e)=>{return this.navigation=new v.default(e),this.pageList=new S.default(e),this.navigation}):new Promise((e)=>{this.navigation=new v.default,this.pageList=new S.default,e(this.navigation)})}section(e){return this.spine.get(e)}renderTo(e,t){return this.rendition=new N.default(this,t),this.rendition.attachTo(e),this.rendition}setRequestCredentials(e){this.settings.requestCredentials=e}setRequestHeaders(e){this.settings.requestHeaders=e}unarchive(e,t){return this.archive=new k.default,this.archive.open(e,t)}coverUrl(){var e=this.loaded.cover.then(()=>{return this.archived?this.resources.get(this.cover):this.cover});return e}replacements(){return this.spine.hooks.serialize.register((e,t)=>{t.output=this.resources.substitute(e,t.url)}),this.resources.replacements().then(()=>{return this.resources.replaceCss()})}getRange(e){var t=new I.default(e),n=this.spine.get(t.spinePos),i=this.load.bind(this);return n?n.load(i).then(function(){var e=t.toRange(n.document);return e}):new Promise((e,t)=>{t('CFI could not be found')})}key(e){var t=e||this.package.metadata.identifier||this.url.filename;return`epubjs:${'0.3'}:${t}`}destroy(){this.opened=void 0,this.loading=void 0,this.loaded=void 0,this.ready=void 0,this.isOpen=!1,this.isRendered=!1,this.spine&&this.spine.destroy(),this.locations&&this.locations.destroy(),this.pageList&&this.pageList.destroy(),this.archive&&this.archive.destroy(),this.resources&&this.resources.destroy(),this.container&&this.container.destroy(),this.packaging&&this.packaging.destroy(),this.rendition&&this.rendition.destroy(),this.spine=void 0,this.locations=void 0,this.pageList=void 0,this.archive=void 0,this.resources=void 0,this.container=void 0,this.packaging=void 0,this.rendition=void 0,this.navigation=void 0,this.url=void 0,this.path=void 0,this.archived=!1}}(0,s.default)(z.prototype),t.default=z,e.exports=t['default']},function(e,t,n){'use strict';var i=n(26),a=n(34),s=n(35),o=n(36),r;r=e.exports=function(t,n){var s,r,l,d,p;return 2>arguments.length||'string'!=typeof t?(d=n,n=t,t=null):d=arguments[2],null==t?(s=l=!0,r=!1):(s=o.call(t,'c'),r=o.call(t,'e'),l=o.call(t,'w')),p={value:n,configurable:s,enumerable:r,writable:l},d?i(a(d),p):p},r.gs=function(t,n,r){var l,d,p,h;return'string'==typeof t?p=arguments[3]:(p=r,r=n,n=t,t=null),null==n?n=void 0:s(n)?null==r?r=void 0:!s(r)&&(p=r,r=void 0):(p=n,n=r=void 0),null==t?(l=!0,d=!1):(l=o.call(t,'c'),d=o.call(t,'e')),h={get:n,set:r,configurable:l,enumerable:d},p?i(a(p),h):h}},function(e,t,n){'use strict';e.exports=n(27)()?Object.assign:n(28)},function(e){'use strict';e.exports=function(){var e=Object.assign,t;return!('function'!=typeof e)&&(t={foo:'raz'},e(t,{bar:'dwa'},{trzy:'trzy'}),'razdwatrzy'===t.foo+t.bar+t.trzy)}},function(e,t,n){'use strict';var a=n(29),o=n(33);e.exports=function(e,t){var n=s(arguments.length,2),r,l,i;for(e=Object(o(e)),i=function(n){try{e[n]=t[n]}catch(t){r||(r=t)}},l=1;l<n;++l)t=arguments[l],a(t).forEach(i);if(r!==void 0)throw r;return e}},function(e,t,n){'use strict';e.exports=n(30)()?Object.keys:n(31)},function(e){'use strict';e.exports=function(){try{return Object.keys('primitive'),!0}catch(t){return!1}}},function(e,t,n){'use strict';var i=n(9),a=Object.keys;e.exports=function(e){return a(i(e)?Object(e):e)}},function(e){'use strict';e.exports=function(){}},function(e,t,n){'use strict';var i=n(9);e.exports=function(e){if(!i(e))throw new TypeError('Cannot use null or undefined');return e}},function(e,t,n){'use strict';var i=n(9),a=Array.prototype.forEach,s=Object.create,o=function(e,t){for(var n in e)t[n]=e[n]};e.exports=function(){var e=s(null);return a.call(arguments,function(t){i(t)&&o(Object(t),e)}),e}},function(e){'use strict';e.exports=function(e){return'function'==typeof e}},function(e,t,i){'use strict';e.exports=i(37)()?n.contains:i(38)},function(e){'use strict';var t='razdwatrzy';e.exports=function(){return!('function'!=typeof t.contains)&&!0===t.contains('dwa')&&!1===t.contains('foo')}},function(e){'use strict';var t=n.indexOf;e.exports=function(e){return-1<t.call(this,e,arguments[1])}},function(e){'use strict';e.exports=function(e){if('function'!=typeof e)throw new TypeError(e+' is not a function');return e}},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0});var a=n(1),s=i(a),o=n(10),r=i(o),l=n(41),d=i(l),c=n(7);t.default=class{constructor(){this.spineItems=[],this.spineByHref={},this.spineById={},this.hooks={},this.hooks.serialize=new r.default,this.hooks.content=new r.default,this.hooks.content.register(c.replaceBase),this.hooks.content.register(c.replaceCanonical),this.hooks.content.register(c.replaceMeta),this.epubcfi=new s.default,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}unpack(e,t,n){this.items=e.spine,this.manifest=e.manifest,this.spineNodeIndex=e.spineNodeIndex,this.baseUrl=e.baseUrl||e.basePath||'',this.length=this.items.length,this.items.forEach((e,i)=>{var a=this.manifest[e.idref],s;e.index=i,e.cfiBase=this.epubcfi.generateChapterComponent(this.spineNodeIndex,e.index,e.idref),e.href&&(e.url=t(e.href,!0),e.canonical=n(e.href)),a&&(e.href=a.href,e.url=t(e.href,!0),e.canonical=n(e.href),a.properties.length&&e.properties.push.apply(e.properties,a.properties)),'yes'===e.linear?(e.prev=function(){for(var t=e.index;0<t;){var n=this.get(t-1);if(n&&n.linear)return n;t-=1}}.bind(this),e.next=function(){for(var t=e.index;t<this.spineItems.length-1;){var n=this.get(t+1);if(n&&n.linear)return n;t+=1}}.bind(this)):(e.prev=function(){},e.next=function(){}),s=new d.default(e,this.hooks),this.append(s)}),this.loaded=!0}get(e){var t=0;if('undefined'==typeof e)for(;t<this.spineItems.length;){var n=this.spineItems[t];if(n&&n.linear)break;t+=1}else if(this.epubcfi.isCfiString(e)){var i=new s.default(e);t=i.spinePos}else'number'==typeof e||!1===isNaN(e)?t=e:'string'==typeof e&&0===e.indexOf('#')?t=this.spineById[e.substring(1)]:'string'==typeof e&&(e=e.split('#')[0],t=this.spineByHref[e]||this.spineByHref[encodeURI(e)]);return this.spineItems[t]||null}append(e){var t=this.spineItems.length;return e.index=t,this.spineItems.push(e),this.spineByHref[decodeURI(e.href)]=t,this.spineByHref[encodeURI(e.href)]=t,this.spineByHref[e.href]=t,this.spineById[e.idref]=t,t}prepend(e){return this.spineByHref[e.href]=0,this.spineById[e.idref]=0,this.spineItems.forEach(function(e,t){e.index=t}),0}remove(e){var t=this.spineItems.indexOf(e);if(-1<t)return delete this.spineByHref[e.href],delete this.spineById[e.idref],this.spineItems.splice(t,1)}each(){return this.spineItems.forEach.apply(this.spineItems,arguments)}first(){var e=0;do{var t=this.get(e);if(t&&t.linear)return t;e+=1}while(e<this.spineItems.length)}last(){var e=this.spineItems.length-1;do{var t=this.get(e);if(t&&t.linear)return t;e-=1}while(0<=e)}destroy(){this.each((e)=>e.destroy()),this.spineItems=void 0,this.spineByHref=void 0,this.spineById=void 0,this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.epubcfi=void 0,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}},e.exports=t['default']},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0});var a=n(0),s=n(1),o=i(s),r=n(10),l=i(r),d=n(7);t.default=class{constructor(e,t){this.idref=e.idref,this.linear='yes'===e.linear,this.properties=e.properties,this.index=e.index,this.href=e.href,this.url=e.url,this.canonical=e.canonical,this.next=e.next,this.prev=e.prev,this.cfiBase=e.cfiBase,t?this.hooks=t:(this.hooks={},this.hooks.serialize=new l.default(this),this.hooks.content=new l.default(this)),this.document=void 0,this.contents=void 0,this.output=void 0}load(e){var t=e||this.request||n(11),i=new a.defer,s=i.promise;return this.contents?i.resolve(this.contents):t(this.url).then(function(e){return this.document=e,this.contents=e.documentElement,this.hooks.content.trigger(this.document,this)}.bind(this)).then(function(){i.resolve(this.contents)}.bind(this)).catch(function(e){i.reject(e)}),s}base(){return(0,d.replaceBase)(this.document,this)}render(e){var t=new a.defer,i=t.promise;return this.output,this.load(e).then(function(e){var t='undefined'!=typeof navigator&&navigator.userAgent||'',i=0<=t.indexOf('Trident'),a;a='undefined'==typeof XMLSerializer||i?n(15).XMLSerializer:XMLSerializer;var s=new a;return this.output=s.serializeToString(e),this.output}.bind(this)).then(function(){return this.hooks.serialize.trigger(this.output,this)}.bind(this)).then(function(){t.resolve(this.output)}.bind(this)).catch(function(e){t.reject(e)}),i}find(e){var t=this,n=[],i=e.toLowerCase(),s=function(e){for(var a=e.textContent.toLowerCase(),s=t.document.createRange(),o=-1,r=150,l,d,c;-1!=d;)d=a.indexOf(i,o+1),-1!=d&&(s=t.document.createRange(),s.setStart(e,d),s.setEnd(e,d+i.length),l=t.cfiFromRange(s),e.textContent.length<r?c=e.textContent:(c=e.textContent.substring(d-r/2,d+r/2),c='...'+c+'...'),n.push({cfi:l,excerpt:c})),o=d};return(0,a.sprint)(t.document,function(e){s(e)}),n}reconcileLayoutSettings(e){var t={layout:e.layout,spread:e.spread,orientation:e.orientation};return this.properties.forEach(function(e){var n=e.replace('rendition:',''),i=n.indexOf('-'),a,s;-1!=i&&(a=n.slice(0,i),s=n.slice(i+1),t[a]=s)}),t}cfiFromRange(e){return new o.default(e,this.cfiBase).toString()}cfiFromElement(e){return new o.default(e,this.cfiBase).toString()}unload(){this.document=void 0,this.contents=void 0,this.output=void 0}destroy(){this.unload(),this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.idref=void 0,this.linear=void 0,this.properties=void 0,this.index=void 0,this.href=void 0,this.url=void 0,this.next=void 0,this.prev=void 0,this.cfiBase=void 0}},e.exports=t['default']},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0});var s=n(0),o=n(12),r=i(o),l=n(1),d=i(l),c=n(3),p=n(2),h=i(p);class u{constructor(e,t,n){this.spine=e,this.request=t,this.pause=n||100,this.q=new r.default(this),this.epubcfi=new d.default,this._locations=[],this.total=0,this.break=150,this._current=0,this.currentLocation='',this._currentCfi='',this.processingTimeout=void 0}generate(e){return e&&(this.break=e),this.q.pause(),this.spine.each(function(e){e.linear&&this.q.enqueue(this.process.bind(this),e)}.bind(this)),this.q.run().then(function(){return this.total=this._locations.length-1,this._currentCfi&&(this.currentLocation=this._currentCfi),this._locations}.bind(this))}createRange(){return{startContainer:void 0,startOffset:void 0,endContainer:void 0,endOffset:void 0}}process(e){return e.load(this.request).then(function(t){var n=new s.defer,i=this.parse(t,e.cfiBase);return this._locations=this._locations.concat(i),e.unload(),this.processingTimeout=setTimeout(()=>n.resolve(i),this.pause),n.promise}.bind(this))}parse(e,t,n){var i=[],a=e.ownerDocument,o=(0,s.qs)(a,'body'),r=0,l=n||this.break,c,p;if((0,s.sprint)(o,function(e){var n=e.length,a=0,s;if(0===e.textContent.trim().length)return!1;for(0==r&&(c=this.createRange(),c.startContainer=e,c.startOffset=0),s=l-r,s>n&&(r+=n,a=n);a<n;)if(s=l-r,0===r&&(a+=1,c=this.createRange(),c.startContainer=e,c.startOffset=a),a+s>=n)r+=n-a,a=n;else{a+=s,c.endContainer=e,c.endOffset=a;var o=new d.default(c,t).toString();i.push(o),r=0}p=e}.bind(this)),c&&c.startContainer&&p){c.endContainer=p,c.endOffset=p.length;var h=new d.default(c,t).toString();i.push(h),r=0}return i}locationFromCfi(e){var t;return(d.default.prototype.isCfiString(e)&&(e=new d.default(e)),0===this._locations.length)?-1:(t=(0,s.locationOf)(e,this._locations,this.epubcfi.compare),t>this.total?this.total:t)}percentageFromCfi(e){if(0===this._locations.length)return null;var t=this.locationFromCfi(e);return this.percentageFromLocation(t)}percentageFromLocation(e){return e&&this.total?e/this.total:0}cfiFromLocation(e){var t=-1;return'number'!=typeof e&&(e=parseInt(e)),0<=e&&e<this._locations.length&&(t=this._locations[e]),t}cfiFromPercentage(e){var t;if(1<e&&console.warn('Normalize cfiFromPercentage value to between 0 - 1'),1<=e){var n=new d.default(this._locations[this.total]);return n.collapse(),n.toString()}return t=a(this.total*e),this.cfiFromLocation(t)}load(e){return this._locations='string'==typeof e?JSON.parse(e):e,this.total=this._locations.length-1,this._locations}save(){return JSON.stringify(this._locations)}getCurrent(){return this._current}setCurrent(e){var t;if('string'==typeof e)this._currentCfi=e;else if('number'==typeof e)this._current=e;else return;0===this._locations.length||('string'==typeof e?(t=this.locationFromCfi(e),this._current=t):t=e,this.emit(c.EVENTS.LOCATIONS.CHANGED,{percentage:this.percentageFromLocation(t)}))}get currentLocation(){return this._current}set currentLocation(e){this.setCurrent(e)}length(){return this._locations.length}destroy(){this.spine=void 0,this.request=void 0,this.pause=void 0,this.q.stop(),this.q=void 0,this.epubcfi=void 0,this._locations=void 0,this.total=void 0,this.break=void 0,this._current=void 0,this.currentLocation=void 0,this._currentCfi=void 0,clearTimeout(this.processingTimeout)}}(0,h.default)(u.prototype),t.default=u,e.exports=t['default']},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var i=n(6),a=function(e){return e&&e.__esModule?e:{default:e}}(i),s=n(0);t.default=class{constructor(e){this.packagePath='',this.directory='',this.encoding='',e&&this.parse(e)}parse(e){var t;if(!e)throw new Error('Container File Not Found');if(t=(0,s.qs)(e,'rootfile'),!t)throw new Error('No RootFile Found');this.packagePath=t.getAttribute('full-path'),this.directory=a.default.dirname(this.packagePath),this.encoding=e.xmlEncoding}destroy(){this.packagePath=void 0,this.directory=void 0,this.encoding=void 0}},e.exports=t['default']},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var i=n(0);t.default=class{constructor(e){this.manifest={},this.navPath='',this.ncxPath='',this.coverPath='',this.spineNodeIndex=0,this.spine=[],this.metadata={},e&&this.parse(e)}parse(e){var t,n,a;if(!e)throw new Error('Package File Not Found');if(t=(0,i.qs)(e,'metadata'),!t)throw new Error('No Metadata Found');if(n=(0,i.qs)(e,'manifest'),!n)throw new Error('No Manifest Found');if(a=(0,i.qs)(e,'spine'),!a)throw new Error('No Spine Found');return this.manifest=this.parseManifest(n),this.navPath=this.findNavPath(n),this.ncxPath=this.findNcxPath(n,a),this.coverPath=this.findCoverPath(e),this.spineNodeIndex=(0,i.indexOfElementNode)(a),this.spine=this.parseSpine(a,this.manifest),this.metadata=this.parseMetadata(t),this.metadata.direction=a.getAttribute('page-progression-direction'),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex}}parseMetadata(e){var t={title:this.getElementText(e,'title'),creator:this.getElementText(e,'creator'),description:this.getElementText(e,'description'),pubdate:this.getElementText(e,'date'),publisher:this.getElementText(e,'publisher'),identifier:this.getElementText(e,'identifier'),language:this.getElementText(e,'language'),rights:this.getElementText(e,'rights'),modified_date:this.getPropertyText(e,'dcterms:modified'),layout:this.getPropertyText(e,'rendition:layout'),orientation:this.getPropertyText(e,'rendition:orientation'),flow:this.getPropertyText(e,'rendition:flow'),viewport:this.getPropertyText(e,'rendition:viewport')};return t}parseManifest(e){var t={},n=(0,i.qsa)(e,'item'),a=Array.prototype.slice.call(n);return a.forEach(function(e){var n=e.getAttribute('id'),i=e.getAttribute('href')||'',a=e.getAttribute('media-type')||'',s=e.getAttribute('properties')||'';t[n]={href:i,type:a,properties:s.length?s.split(' '):[]}}),t}parseSpine(e){var t=[],n=(0,i.qsa)(e,'itemref'),a=Array.prototype.slice.call(n);return a.forEach(function(e,n){var i=e.getAttribute('idref'),a=e.getAttribute('properties')||'',s=a.length?a.split(' '):[],o={idref:i,linear:e.getAttribute('linear')||'yes',properties:s,index:n};t.push(o)}),t}findNavPath(e){var t=(0,i.qsp)(e,'item',{properties:'nav'});return!!t&&t.getAttribute('href')}findNcxPath(e,t){var n=(0,i.qsp)(e,'item',{"media-type":'application/x-dtbncx+xml'}),a;return n||(a=t.getAttribute('toc'),a&&(n=e.getElementById(a))),!!n&&n.getAttribute('href')}findCoverPath(e){var t=(0,i.qs)(e,'package'),n=t.getAttribute('version');if('2.0'===n){var a=(0,i.qsp)(e,'meta',{name:'cover'});if(a){var s=a.getAttribute('content'),o=e.getElementById(s);return o?o.getAttribute('href'):''}return!1}var r=(0,i.qsp)(e,'item',{properties:'cover-image'});return r?r.getAttribute('href'):''}getElementText(e,t){var n=e.getElementsByTagNameNS('http://purl.org/dc/elements/1.1/',t),i;return n&&0!==n.length?(i=n[0],i.childNodes.length?i.childNodes[0].nodeValue:''):''}getPropertyText(e,t){var n=(0,i.qsp)(e,'meta',{property:t});return n&&n.childNodes.length?n.childNodes[0].nodeValue:''}load(e){return this.metadata=e.metadata,this.spine=e.spine.map((e,t)=>{return e.index=t,e}),e.resources.forEach((e,t)=>{this.manifest[t]=e,e.rel&&'cover'===e.rel[0]&&(this.coverPath=e.href)}),this.spineNodeIndex=0,this.toc=e.toc.map((e)=>{return e.label=e.title,e}),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex,toc:this.toc}}destroy(){this.manifest=void 0,this.navPath=void 0,this.ncxPath=void 0,this.coverPath=void 0,this.spineNodeIndex=void 0,this.spine=void 0,this.metadata=void 0}},e.exports=t['default']},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var a=n(0);t.default=class{constructor(e){this.toc=[],this.tocByHref={},this.tocById={},this.landmarks=[],this.landmarksByType={},this.length=0,e&&this.parse(e)}parse(e){var t=e.nodeType,n,i;t&&(n=(0,a.qs)(e,'html'),i=(0,a.qs)(e,'ncx')),t?n?(this.toc=this.parseNav(e),this.landmarks=this.parseLandmarks(e)):i&&(this.toc=this.parseNcx(e)):this.toc=this.load(e),this.length=0,this.unpack(this.toc)}unpack(e){for(var t=0,n;t<e.length;t++)n=e[t],n.href&&(this.tocByHref[n.href]=t),n.id&&(this.tocById[n.id]=t),this.length++,n.subitems.length&&this.unpack(n.subitems)}get(e){var t;return e?(0===e.indexOf('#')?t=this.tocById[e.substring(1)]:e in this.tocByHref&&(t=this.tocByHref[e]),this.toc[t]):this.toc}landmark(e){var t;return e?(t=this.landmarksByType[e],this.landmarks[t]):this.landmarks}parseNav(e){var t=(0,a.querySelectorByType)(e,'nav','toc'),n=t?(0,a.qsa)(t,'li'):[],s=n.length,o={},r=[],l,i,d;if(!n||0===s)return r;for(l=0;l<s;++l)i=this.navItem(n[l]),i&&(o[i.id]=i,i.parent?(d=o[i.parent],d.subitems.push(i)):r.push(i));return r}navItem(e){var t=e.getAttribute('id')||void 0,n=(0,a.filterChildren)(e,'a',!0);if(n){var i=n.getAttribute('href')||'',s=n.textContent||'',o=(0,a.getParentByTagName)(e,'li'),r;for(o&&(r=o.getAttribute('id'));!r&&o;)o=(0,a.getParentByTagName)(o,'li'),o&&(r=o.getAttribute('id'));return{id:t,href:i,label:s,subitems:[],parent:r}}}parseLandmarks(e){var t=(0,a.querySelectorByType)(e,'nav','landmarks'),n=t?(0,a.qsa)(t,'li'):[],s=n.length,o=[],r,i;if(!n||0===s)return o;for(r=0;r<s;++r)i=this.landmarkItem(n[r]),i&&(o.push(i),this.landmarksByType[i.type]=r);return o}landmarkItem(e){var t=(0,a.filterChildren)(e,'a',!0);if(t){var n=t.getAttributeNS('http://www.idpf.org/2007/ops','type')||void 0,i=t.getAttribute('href')||'',s=t.textContent||'';return{href:i,label:s,type:n}}}parseNcx(e){var t=(0,a.qsa)(e,'navPoint'),n=t.length,s={},o=[],r,i,l;if(!t||0===n)return o;for(r=0;r<n;++r)i=this.ncxItem(t[r]),s[i.id]=i,i.parent?(l=s[i.parent],l.subitems.push(i)):o.push(i);return o}ncxItem(e){var t=e.getAttribute('id')||!1,n=(0,a.qs)(e,'content'),i=n.getAttribute('src'),s=(0,a.qs)(e,'navLabel'),o=s.textContent?s.textContent:'',r=e.parentNode,l;return r&&'navPoint'===r.nodeName&&(l=r.getAttribute('id')),{id:t,href:i,label:o,subitems:[],parent:l}}load(e){return e.map((e)=>{return e.label=e.title,e.children&&(e.subitems=this.load(e.children)),e})}forEach(e){return this.toc.forEach(e)}},e.exports=t['default']},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0});var a=n(7),s=n(0),o=n(5),r=i(o),l=n(16),d=i(l),c=n(4),p=i(c),h=n(6),u=i(h);t.default=class{constructor(e,t){this.settings={replacements:t&&t.replacements||'base64',archive:t&&t.archive,resolver:t&&t.resolver,request:t&&t.request},this.manifest=e,this.resources=Object.keys(e).map(function(t){return e[t]}),this.replacementUrls=[],this.html=[],this.assets=[],this.css=[],this.urls=[],this.cssUrls=[],this.split(),this.splitUrls()}split(){this.html=this.resources.filter(function(e){if('application/xhtml+xml'===e.type||'text/html'===e.type)return!0}),this.assets=this.resources.filter(function(e){if('application/xhtml+xml'!==e.type&&'text/html'!==e.type)return!0}),this.css=this.resources.filter(function(e){if('text/css'===e.type)return!0})}splitUrls(){this.urls=this.assets.map(function(e){return e.href}.bind(this)),this.cssUrls=this.css.map(function(e){return e.href})}createUrl(e){var t=new r.default(e),n=d.default.lookup(t.filename);return this.settings.archive?this.settings.archive.createUrl(e,{base64:'base64'===this.settings.replacements}):'base64'===this.settings.replacements?this.settings.request(e,'blob').then((e)=>{return(0,s.blob2base64)(e)}).then((e)=>{return(0,s.createBase64Url)(e,n)}):this.settings.request(e,'blob').then((e)=>{return(0,s.createBlobUrl)(e,n)})}replacements(){if('none'===this.settings.replacements)return new Promise(function(e){e(this.urls)}.bind(this));var e=this.urls.map((e)=>{var t=this.settings.resolver(e);return this.createUrl(t).catch((e)=>{return console.error(e),null})});return Promise.all(e).then((e)=>{return this.replacementUrls=e.filter((e)=>{return'string'==typeof e}),e})}replaceCss(e,t){var n=[];return e=e||this.settings.archive,t=t||this.settings.resolver,this.cssUrls.forEach(function(i){var a=this.createCssFile(i,e,t).then(function(e){var t=this.urls.indexOf(i);-1<t&&(this.replacementUrls[t]=e)}.bind(this));n.push(a)}.bind(this)),Promise.all(n)}createCssFile(e){var t;if(u.default.isAbsolute(e))return new Promise(function(e){e()});var n=this.settings.resolver(e),i;i=this.settings.archive?this.settings.archive.getText(n):this.settings.request(n,'text');var o=this.urls.map((e)=>{var t=this.settings.resolver(e),i=new p.default(n).relative(t);return i});return i?i.then((e)=>{return e=(0,a.substitute)(e,o,this.replacementUrls),t='base64'===this.settings.replacements?(0,s.createBase64Url)(e,'text/css'):(0,s.createBlobUrl)(e,'text/css'),t},()=>{return new Promise(function(e){e()})}):new Promise(function(e){e()})}relativeTo(e,t){return t=t||this.settings.resolver,this.urls.map(function(n){var i=t(n),a=new p.default(e).relative(i);return a}.bind(this))}get(e){var t=this.urls.indexOf(e);return-1===t?void 0:this.replacementUrls.length?new Promise(function(e){e(this.replacementUrls[t])}.bind(this)):this.createUrl(e)}substitute(e,t){var n;return n=t?this.relativeTo(t):this.urls,(0,a.substitute)(e,n,this.replacementUrls)}destroy(){this.settings=void 0,this.manifest=void 0,this.resources=void 0,this.replacementUrls=void 0,this.html=void 0,this.assets=void 0,this.css=void 0,this.urls=void 0,this.cssUrls=void 0}},e.exports=t['default']},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var a=n(1),s=function(e){return e&&e.__esModule?e:{default:e}}(a),o=n(0);t.default=class{constructor(e){this.pages=[],this.locations=[],this.epubcfi=new s.default,this.firstPage=0,this.lastPage=0,this.totalPages=0,this.toc=void 0,this.ncx=void 0,e&&(this.pageList=this.parse(e)),this.pageList&&this.pageList.length&&this.process(this.pageList)}parse(e){var t=(0,o.qs)(e,'html'),n=(0,o.qs)(e,'ncx');if(t)return this.parseNav(e)}parseNav(e){var t=(0,o.querySelectorByType)(e,'nav','page-list'),n=t?(0,o.qsa)(t,'li'):[],a=n.length,s=[],r,i;if(!n||0===a)return s;for(r=0;r<a;++r)i=this.item(n[r]),s.push(i);return s}item(e){var t=(0,o.qs)(e,'a'),n=t.getAttribute('href')||'',i=t.textContent||'',a=parseInt(i),s=n.indexOf('epubcfi'),r,l,d;return-1==s?{href:n,page:a}:(r=n.split('#'),l=r[0],d=!!(1<r.length)&&r[1],{cfi:d,href:n,packageUrl:l,page:a})}process(e){e.forEach(function(e){this.pages.push(e.page),e.cfi&&this.locations.push(e.cfi)},this),this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage}pageFromCfi(e){var t=-1;if(0===this.locations.length)return-1;var n=(0,o.indexOfSorted)(e,this.locations,this.epubcfi.compare);return-1==n?(n=(0,o.locationOf)(e,this.locations,this.epubcfi.compare),t=0<=n-1?this.pages[n-1]:this.pages[0],void 0!==t||(t=-1)):t=this.pages[n],t}cfiFromPage(e){var t=-1;'number'!=typeof e&&(e=parseInt(e));var n=this.pages.indexOf(e);return-1!=n&&(t=this.locations[n]),t}pageFromPercentage(e){var t=i(this.totalPages*e);return t}percentageFromPage(e){var t=(e-this.firstPage)/this.totalPages;return i(1e3*t)/1e3}percentageFromCfi(e){var t=this.pageFromCfi(e),n=this.percentageFromPage(t);return n}destroy(){this.pages=void 0,this.locations=void 0,this.epubcfi=void 0,this.pageList=void 0,this.toc=void 0,this.ncx=void 0}},e.exports=t['default']},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var i=n(0),s=n(3),r=n(2),l=function(e){return e&&e.__esModule?e:{default:e}}(r);class d{constructor(e){this.settings=e,this.name=e.layout||'reflowable',this._spread='none'!==e.spread,this._minSpreadWidth=e.minSpreadWidth||800,this._evenSpreads=e.evenSpreads||!1,this._flow='scrolled'===e.flow||'scrolled-continuous'===e.flow||'scrolled-doc'===e.flow?'scrolled':'paginated',this.width=0,this.height=0,this.spreadWidth=0,this.delta=0,this.columnWidth=0,this.gap=0,this.divisor=1,this.props={name:this.name,spread:this._spread,flow:this._flow,width:0,height:0,spreadWidth:0,delta:0,columnWidth:0,gap:0,divisor:1}}flow(e){return'undefined'!=typeof e&&(this._flow='scrolled'===e||'scrolled-continuous'===e||'scrolled-doc'===e?'scrolled':'paginated',this.update({flow:this._flow})),this._flow}spread(e,t){return e&&(this._spread='none'!==e,this.update({spread:this._spread})),0<=t&&(this._minSpreadWidth=t),this._spread}calculate(e,t,n){var i=1,a=n||0,s=e,r=t,l=o(s/12),d,c,p,h;i=this._spread&&s>=this._minSpreadWidth?2:1,'reflowable'!==this.name||'paginated'!==this._flow||0<=n||(a=0==l%2?l:l-1),'pre-paginated'===this.name&&(a=0),1<i?(d=s/i-a,p=d+a):(d=s,p=s),'pre-paginated'===this.name&&1<i&&(s=d),c=d*i+a,h=s,this.width=s,this.height=r,this.spreadWidth=c,this.pageWidth=p,this.delta=h,this.columnWidth=d,this.gap=a,this.divisor=i,this.update({width:s,height:r,spreadWidth:c,pageWidth:p,delta:h,columnWidth:d,gap:a,divisor:i})}format(e){var t;return t='pre-paginated'===this.name?e.fit(this.columnWidth,this.height):'paginated'===this._flow?e.columns(this.width,this.height,this.columnWidth,this.gap):e.size(this.width,null),t}count(e,t){var n,i;return'pre-paginated'===this.name?(n=1,i=1):'paginated'===this._flow?(t=t||this.delta,n=a(e/t),i=n*this.divisor):(t=t||this.height,n=a(e/t),i=n),{spreads:n,pages:i}}update(e){if(Object.keys(e).forEach((t)=>{this.props[t]===e[t]&&delete e[t]}),0<Object.keys(e).length){var t=(0,i.extend)(this.props,e);this.emit(s.EVENTS.LAYOUT.UPDATED,t,e)}}}(0,l.default)(d.prototype),t.default=d,e.exports=t['default']},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var i=n(5),a=function(e){return e&&e.__esModule?e:{default:e}}(i);t.default=class{constructor(e){this.rendition=e,this._themes={default:{rules:{},url:'',serialized:''}},this._overrides={},this._current='default',this._injected=[],this.rendition.hooks.content.register(this.inject.bind(this)),this.rendition.hooks.content.register(this.overrides.bind(this))}register(){return 0===arguments.length?void 0:1===arguments.length&&'object'==typeof arguments[0]?this.registerThemes(arguments[0]):1===arguments.length&&'string'==typeof arguments[0]?this.default(arguments[0]):2===arguments.length&&'string'==typeof arguments[1]?this.registerUrl(arguments[0],arguments[1]):2===arguments.length&&'object'==typeof arguments[1]?this.registerRules(arguments[0],arguments[1]):void 0}default(e){return e?'string'==typeof e?this.registerUrl('default',e):'object'==typeof e?this.registerRules('default',e):void 0:void 0}registerThemes(e){for(var t in e)e.hasOwnProperty(t)&&('string'==typeof e[t]?this.registerUrl(t,e[t]):this.registerRules(t,e[t]))}registerUrl(e,t){var n=new a.default(t);this._themes[e]={url:n.toString()},this._injected[e]&&this.update(e)}registerRules(e,t){this._themes[e]={rules:t},this._injected[e]&&this.update(e)}select(e){var t=this._current,n;this._current=e,this.update(e),n=this.rendition.getContents(),n.forEach((n)=>{n.removeClass(t),n.addClass(e)})}update(e){var t=this.rendition.getContents();t.forEach((t)=>{this.add(e,t)})}inject(e){var t=[],n=this._themes,i;for(var a in n)n.hasOwnProperty(a)&&(a===this._current||'default'==a)&&(i=n[a],(i.rules&&0<Object.keys(i.rules).length||i.url&&-1===t.indexOf(i.url))&&this.add(a,e),this._injected.push(a));'default'!=this._current&&e.addClass(this._current)}add(e,t){var n=this._themes[e];n&&t&&(n.url?t.addStylesheet(n.url):n.serialized||n.rules&&(t.addStylesheetRules(n.rules),n.injected=!0))}override(e,t){var n=this.rendition.getContents();this._overrides[e]=t,n.forEach((t)=>{t.css(e,this._overrides[e])})}overrides(e){var t=this._overrides;for(var n in t)t.hasOwnProperty(n)&&e.css(n,t[n])}fontSize(e){this.override('font-size',e)}font(e){this.override('font-family',e)}destroy(){this.rendition=void 0,this._themes=void 0,this._overrides=void 0,this._current=void 0,this._injected=void 0}},e.exports=t['default']},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0});var a=n(2),s=i(a),o=n(1),r=i(o);class l{constructor(e){var t=e.type,n=e.cfiRange,i=e.data,a=e.sectionIndex,s=e.cb;this.type=t,this.cfiRange=n,this.data=i,this.sectionIndex=a,this.mark=void 0,this.cb=s}update(e){this.data=e}attach(e){var t=this.cfiRange,n=this.data,i=this.type,a=this.mark,s=this.cb,o;return'highlight'===i?o=e.highlight(t,n,s):'underline'===i?o=e.underline(t,n,s):'mark'===i&&(o=e.mark(t,n,s)),this.mark=o,o}detach(e){var t=this.cfiRange,n=this.type,i;return e&&('highlight'===n?i=e.unhighlight(t):'underline'===n?i=e.ununderline(t):'mark'===n&&(i=e.unmark(t))),this.mark=void 0,i}text(){}}(0,s.default)(l.prototype),t.default=class{constructor(e){this.rendition=e,this.highlights=[],this.underlines=[],this.marks=[],this._annotations={},this._annotationsBySectionIndex={},this.rendition.hooks.render.register(this.inject.bind(this)),this.rendition.hooks.unloaded.register(this.clear.bind(this))}add(e,t,n,i){var a=encodeURI(t),s=new r.default(t),o=s.spinePos,d=new l({type:e,cfiRange:t,data:n,sectionIndex:o,cb:i});this._annotations[a]=d,o in this._annotationsBySectionIndex?this._annotationsBySectionIndex[o].push(a):this._annotationsBySectionIndex[o]=[a];var c=this.rendition.views();return c.forEach((e)=>{d.sectionIndex===e.index&&d.attach(e)}),d}remove(e,t){var n=encodeURI(e);if(n in this._annotations){var i=this._annotations[n];if(t&&i.type!==t)return;var a=this.rendition.views();a.forEach((e)=>{this._removeFromAnnotationBySectionIndex(i.sectionIndex,n),i.sectionIndex===e.index&&i.detach(e)}),delete this._annotations[n]}}_removeFromAnnotationBySectionIndex(e,t){this._annotationsBySectionIndex[e]=this._annotationsAt(e).filter((e)=>e!==t)}_annotationsAt(e){return this._annotationsBySectionIndex[e]}highlight(e,t,n){this.add('highlight',e,t,n)}underline(e,t,n){this.add('underline',e,t,n)}mark(e,t,n){this.add('mark',e,t,n)}each(){return this._annotations.forEach.apply(this._annotations,arguments)}inject(e){var t=e.index;if(t in this._annotationsBySectionIndex){var n=this._annotationsBySectionIndex[t];n.forEach((t)=>{var n=this._annotations[t];n.attach(e)})}}clear(e){var t=e.index;if(t in this._annotationsBySectionIndex){var n=this._annotationsBySectionIndex[t];n.forEach((t)=>{var n=this._annotations[t];n.detach(e)})}}show(){}hide(){}},e.exports=t['default']},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0});var a=n(0),s=n(11),o=i(s),r=n(16),l=i(r),d=n(4),c=i(d);t.default=class{constructor(){this.zip=void 0,this.urlCache={},this.checkRequirements()}checkRequirements(){try{if('undefined'==typeof JSZip){var e=n(52);this.zip=new e}else this.zip=new JSZip}catch(t){throw new Error('JSZip lib not loaded')}}open(e,t){return this.zip.loadAsync(e,{base64:t})}openUrl(e,t){return(0,o.default)(e,'binary').then(function(e){return this.zip.loadAsync(e,{base64:t})}.bind(this))}request(e,t){var n=new a.defer,i=new c.default(e),s;return t||(t=i.extension),s='blob'==t?this.getBlob(e):this.getText(e),s?s.then(function(e){var i=this.handleResponse(e,t);n.resolve(i)}.bind(this)):n.reject({message:'File not found in the epub: '+e,stack:new Error().stack}),n.promise}handleResponse(e,t){var n;return n='json'==t?JSON.parse(e):(0,a.isXml)(t)?(0,a.parse)(e,'text/xml'):'xhtml'==t?(0,a.parse)(e,'application/xhtml+xml'):'html'==t||'htm'==t?(0,a.parse)(e,'text/html'):e,n}getBlob(e,t){var n=window.decodeURIComponent(e.substr(1)),i=this.zip.file(n);if(i)return t=t||l.default.lookup(i.name),i.async('uint8array').then(function(e){return new Blob([e],{type:t})})}getText(e){var t=window.decodeURIComponent(e.substr(1)),n=this.zip.file(t);if(n)return n.async('string').then(function(e){return e})}getBase64(e,t){var n=window.decodeURIComponent(e.substr(1)),i=this.zip.file(n);if(i)return t=t||l.default.lookup(i.name),i.async('base64').then(function(e){return'data:'+t+';base64,'+e})}createUrl(e,t){var n=new a.defer,i=window.URL||window.webkitURL||window.mozURL,s=t&&t.base64,o,r;return e in this.urlCache?(n.resolve(this.urlCache[e]),n.promise):(s?(r=this.getBase64(e),r&&r.then(function(t){this.urlCache[e]=t,n.resolve(t)}.bind(this))):(r=this.getBlob(e),r&&r.then(function(t){o=i.createObjectURL(t),this.urlCache[e]=o,n.resolve(o)}.bind(this))),r||n.reject({message:'File not found in the epub: '+e,stack:new Error().stack}),n.promise)}revokeUrl(e){var t=window.URL||window.webkitURL||window.mozURL,n=this.urlCache[e];n&&t.revokeObjectURL(n)}destroy(){var e=window.URL||window.webkitURL||window.mozURL;for(var t in this.urlCache)e.revokeObjectURL(t);this.zip=void 0,this.urlCache={}}},e.exports=t['default']},function(n){if('undefined'==typeof t){var i=new Error('Cannot find module "JSZip"');throw i.code='MODULE_NOT_FOUND',i}n.exports=t},function(e,t,n){'use strict';(function(n){var i,a,s;(function(o,r){o||(o=window||n),'object'==typeof e&&e.exports?e.exports=r(o):(a=[],i=r,s='function'==typeof i?i.apply(t,a):i,!(s!==void 0&&(e.exports=s)))})(void 0,function(e){function t(e){return void 0!==p[e]}function n(){r.call(this),this._isInvalid=!0}function a(e){return''==e&&n.call(this),e.toLowerCase()}function s(e){var t=e.charCodeAt(0);return 32<t&&127>t&&-1==[34,35,60,62,63,96].indexOf(t)?e:encodeURIComponent(e)}function o(e){var t=e.charCodeAt(0);return 32<t&&127>t&&-1==[34,35,60,62,96].indexOf(t)?e:encodeURIComponent(e)}function i(e,r,l){function d(e){E.push(e)}var f=r||'scheme start',y=0,b='',x=!1,v=!1,E=[];loop:for(;(e[y-1]!=m||0==y)&&!this._isInvalid;){var _=e[y];switch(f){case'scheme start':if(_&&u.test(_))b+=_.toLowerCase(),f='scheme';else if(!r){b='',f='no scheme';continue}else{d('Invalid scheme.');break loop}break;case'scheme':if(_&&g.test(_))b+=_.toLowerCase();else if(':'==_){if(this._scheme=b,b='',r)break loop;t(this._scheme)&&(this._isRelative=!0),f='file'==this._scheme?'relative':this._isRelative&&l&&l._scheme==this._scheme?'relative or authority':this._isRelative?'authority first slash':'scheme data'}else if(!r){b='',y=0,f='no scheme';continue}else if(m==_)break loop;else{d('Code point not allowed in scheme: '+_);break loop}break;case'scheme data':'?'==_?(this._query='?',f='query'):'#'==_?(this._fragment='#',f='fragment'):m!=_&&'\t'!=_&&'\n'!=_&&'\r'!=_&&(this._schemeData+=s(_));break;case'no scheme':if(!l||!t(l._scheme))d('Missing scheme.'),n.call(this);else{f='relative';continue}break;case'relative or authority':if('/'==_&&'/'==e[y+1])f='authority ignore slashes';else{d('Expected /, got: '+_),f='relative';continue}break;case'relative':if(this._isRelative=!0,'file'!=this._scheme&&(this._scheme=l._scheme),m==_){this._host=l._host,this._port=l._port,this._path=l._path.slice(),this._query=l._query,this._username=l._username,this._password=l._password;break loop}else if('/'==_||'\\'==_)'\\'==_&&d('\\ is an invalid code point.'),f='relative slash';else if('?'==_)this._host=l._host,this._port=l._port,this._path=l._path.slice(),this._query='?',this._username=l._username,this._password=l._password,f='query';else if('#'==_)this._host=l._host,this._port=l._port,this._path=l._path.slice(),this._query=l._query,this._fragment='#',this._username=l._username,this._password=l._password,f='fragment';else{var c=e[y+1],w=e[y+2];'file'==this._scheme&&u.test(_)&&(':'==c||'|'==c)&&(m==w||'/'==w||'\\'==w||'?'==w||'#'==w)||(this._host=l._host,this._port=l._port,this._username=l._username,this._password=l._password,this._path=l._path.slice(),this._path.pop()),f='relative path';continue}break;case'relative slash':if('/'==_||'\\'==_)'\\'==_&&d('\\ is an invalid code point.'),f='file'==this._scheme?'file host':'authority ignore slashes';else{'file'!=this._scheme&&(this._host=l._host,this._port=l._port,this._username=l._username,this._password=l._password),f='relative path';continue}break;case'authority first slash':if('/'==_)f='authority second slash';else{d('Expected \'/\', got: '+_),f='authority ignore slashes';continue}break;case'authority second slash':if(f='authority ignore slashes','/'!=_){d('Expected \'/\', got: '+_);continue}break;case'authority ignore slashes':if('/'!=_&&'\\'!=_){f='authority';continue}else d('Expected authority, got: '+_);break;case'authority':if('@'==_){x&&(d('@ already seen.'),b+='%40'),x=!0;for(var S=0,i;S<b.length;S++){if(i=b[S],'\t'==i||'\n'==i||'\r'==i){d('Invalid whitespace in authority.');continue}if(':'==i&&null===this._password){this._password='';continue}var C=s(i);null===this._password?this._username+=C:this._password+=C}b=''}else if(m==_||'/'==_||'\\'==_||'?'==_||'#'==_){y-=b.length,b='',f='host';continue}else b+=_;break;case'file host':if(m==_||'/'==_||'\\'==_||'?'==_||'#'==_){2==b.length&&u.test(b[0])&&(':'==b[1]||'|'==b[1])?f='relative path':0==b.length?f='relative path start':(this._host=a.call(this,b),b='',f='relative path start');continue}else'\t'==_||'\n'==_||'\r'==_?d('Invalid whitespace in file host.'):b+=_;break;case'host':case'hostname':if(':'==_&&!v){if(this._host=a.call(this,b),b='',f='port','hostname'==r)break loop;}else if(m==_||'/'==_||'\\'==_||'?'==_||'#'==_){if(this._host=a.call(this,b),b='',f='relative path start',r)break loop;continue}else'\t'!=_&&'\n'!=_&&'\r'!=_?('['==_?v=!0:']'==_&&(v=!1),b+=_):d('Invalid code point in host/hostname: '+_);break;case'port':if(/[0-9]/.test(_))b+=_;else if(m==_||'/'==_||'\\'==_||'?'==_||'#'==_||r){if(''!=b){var N=parseInt(b,10);N!=p[this._scheme]&&(this._port=N+''),b=''}if(r)break loop;f='relative path start';continue}else'\t'==_||'\n'==_||'\r'==_?d('Invalid code point in port: '+_):n.call(this);break;case'relative path start':if('\\'==_&&d('\'\\\' not allowed in path.'),f='relative path','/'!=_&&'\\'!=_)continue;break;case'relative path':if(m==_||'/'==_||'\\'==_||!r&&('?'==_||'#'==_)){'\\'==_&&d('\\ not allowed in relative path.');var T;(T=h[b.toLowerCase()])&&(b=T),'..'==b?(this._path.pop(),'/'!=_&&'\\'!=_&&this._path.push('')):'.'==b&&'/'!=_&&'\\'!=_?this._path.push(''):'.'!=b&&('file'==this._scheme&&0==this._path.length&&2==b.length&&u.test(b[0])&&'|'==b[1]&&(b=b[0]+':'),this._path.push(b)),b='','?'==_?(this._query='?',f='query'):'#'==_&&(this._fragment='#',f='fragment')}else'\t'!=_&&'\n'!=_&&'\r'!=_&&(b+=s(_));break;case'query':r||'#'!=_?m!=_&&'\t'!=_&&'\n'!=_&&'\r'!=_&&(this._query+=o(_)):(this._fragment='#',f='fragment');break;case'fragment':m!=_&&'\t'!=_&&'\n'!=_&&'\r'!=_&&(this._fragment+=_);}y++}}function r(){this._scheme='',this._schemeData='',this._username='',this._password=null,this._host='',this._port='',this._path=[],this._query='',this._fragment='',this._isInvalid=!1,this._isRelative=!1}function l(e,t){void 0===t||t instanceof l||(t=new l(t+'')),this._url=e,r.call(this);var n=e.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,'');i.call(this,n,null,t)}var d=!1;if(!e.forceJURL)try{var c=new URL('b','http://a');c.pathname='c%20d',d='http://a/c%20d'===c.href}catch(t){}if(d)return e.URL;var p=Object.create(null);p.ftp=21,p.file=0,p.gopher=70,p.http=80,p.https=443,p.ws=80,p.wss=443;var h=Object.create(null);h['%2e']='.',h['.%2e']='..',h['%2e.']='..',h['%2e%2e']='..';var u=/[a-zA-Z]/,g=/[a-zA-Z0-9\+\-\.]/,m;l.prototype={toString:function(){return this.href},get href(){if(this._isInvalid)return this._url;var e='';return(''!=this._username||null!=this._password)&&(e=this._username+(null==this._password?'':':'+this._password)+'@'),this.protocol+(this._isRelative?'//'+e+this.host:'')+this.pathname+this._query+this._fragment},set href(e){r.call(this),i.call(this,e)},get protocol(){return this._scheme+':'},set protocol(e){this._isInvalid||i.call(this,e+':','scheme start')},get host(){return this._isInvalid?'':this._port?this._host+':'+this._port:this._host},set host(e){this._isInvalid||!this._isRelative||i.call(this,e,'host')},get hostname(){return this._host},set hostname(e){this._isInvalid||!this._isRelative||i.call(this,e,'hostname')},get port(){return this._port},set port(e){this._isInvalid||!this._isRelative||i.call(this,e,'port')},get pathname(){return this._isInvalid?'':this._isRelative?'/'+this._path.join('/'):this._schemeData},set pathname(e){this._isInvalid||!this._isRelative||(this._path=[],i.call(this,e,'relative path start'))},get search(){return this._isInvalid||!this._query||'?'==this._query?'':this._query},set search(e){this._isInvalid||!this._isRelative||(this._query='?','?'==e[0]&&(e=e.slice(1)),i.call(this,e,'query'))},get hash(){return this._isInvalid||!this._fragment||'#'==this._fragment?'':this._fragment},set hash(e){this._isInvalid||(this._fragment='#','#'==e[0]&&(e=e.slice(1)),i.call(this,e,'fragment'))},get origin(){var e;if(this._isInvalid||!this._scheme)return'';switch(this._scheme){case'file':return'file://';case'data':case'javascript':case'mailto':return'null';}return e=this.host,e?this._scheme+'://'+e:''}};var f=e.URL;return f&&(l.createObjectURL=function(){return f.createObjectURL.apply(f,arguments)},l.revokeObjectURL=function(e){f.revokeObjectURL(e)}),l})}).call(t,n(8))},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0});var s=n(2),o=i(s),r=n(0),l=n(1),d=i(l),c=n(13),p=i(c),h=n(3),u=n(55);class g{constructor(e,t){this.settings=(0,r.extend)({ignoreClass:'',axis:t.layout&&'scrolled'===t.layout.props.flow?'vertical':'horizontal',direction:void 0,width:0,height:0,layout:void 0,globalLayoutProperties:{},method:void 0},t||{}),this.id='epubjs-view-'+(0,r.uuid)(),this.section=e,this.index=e.index,this.element=this.container(this.settings.axis),this.added=!1,this.displayed=!1,this.rendered=!1,this.fixedWidth=0,this.fixedHeight=0,this.epubcfi=new d.default,this.layout=this.settings.layout,this.pane=void 0,this.highlights={},this.underlines={},this.marks={}}container(e){var t=document.createElement('div');return t.classList.add('epub-view'),t.style.height='0px',t.style.width='0px',t.style.overflow='hidden',t.style.position='relative',t.style.display='block',t.style.flex=e&&'horizontal'==e?'none':'initial',t}create(){return this.iframe?this.iframe:(this.element||(this.element=this.createContainer()),this.iframe=document.createElement('iframe'),this.iframe.id=this.id,this.iframe.scrolling='no',this.iframe.style.overflow='hidden',this.iframe.seamless='seamless',this.iframe.style.border='none',this.iframe.setAttribute('enable-annotation','true'),this.resizing=!0,this.element.style.visibility='hidden',this.iframe.style.visibility='hidden',this.iframe.style.width='0',this.iframe.style.height='0',this._width=0,this._height=0,this.element.setAttribute('ref',this.index),this.element.appendChild(this.iframe),this.added=!0,this.elementBounds=(0,r.bounds)(this.element),this.supportsSrcdoc=!!('srcdoc'in this.iframe),this.settings.method||(this.settings.method=this.supportsSrcdoc?'srcdoc':'write'),this.iframe)}render(e){return this.create(),this.size(),this.sectionRender||(this.sectionRender=this.section.render(e)),this.sectionRender.then(function(e){return this.load(e)}.bind(this)).then(function(){this.layout.format(this.contents);var e=this.contents.writingMode(),t=0===e.indexOf('vertical')?'vertical':'horizontal';return this.setAxis(t),this.emit(h.EVENTS.VIEWS.AXIS,t),this.addListeners(),new Promise((e)=>{this.expand(),e()})}.bind(this),function(t){return this.emit(h.EVENTS.VIEWS.LOAD_ERROR,t),new Promise((e,n)=>{n(t)})}.bind(this)).then(function(){this.emit(h.EVENTS.VIEWS.RENDERED,this.section)}.bind(this))}reset(){this.iframe&&(this.iframe.style.width='0',this.iframe.style.height='0',this._width=0,this._height=0,this._textWidth=void 0,this._contentWidth=void 0,this._textHeight=void 0,this._contentHeight=void 0),this._needsReframe=!0}size(e,t){var n=e||this.settings.width,i=t||this.settings.height;'pre-paginated'===this.layout.name?this.lock('both',n,i):'horizontal'===this.settings.axis?this.lock('height',n,i):this.lock('width',n,i),this.settings.width=n,this.settings.height=i}lock(e,t,n){var i=(0,r.borders)(this.element),a;a=this.iframe?(0,r.borders)(this.iframe):{width:0,height:0},'width'==e&&(0,r.isNumber)(t)&&(this.lockedWidth=t-i.width-a.width),'height'==e&&(0,r.isNumber)(n)&&(this.lockedHeight=n-i.height-a.height),'both'===e&&(0,r.isNumber)(t)&&(0,r.isNumber)(n)&&(this.lockedWidth=t-i.width-a.width,this.lockedHeight=n-i.height-a.height),this.displayed&&this.iframe&&this.expand()}expand(){var e=this.lockedWidth,t=this.lockedHeight,n;!this.iframe||this._expanding||(this._expanding=!0,'pre-paginated'===this.layout.name?(e=this.layout.columnWidth,t=this.layout.height):'horizontal'===this.settings.axis?(e=this.contents.textWidth(),0<e%this.layout.pageWidth&&(e=a(e/this.layout.pageWidth)*this.layout.pageWidth),this.settings.forceEvenPages&&(n=e/this.layout.delta,1<this.layout.divisor&&'reflowable'===this.layout.name&&0<n%2&&(e+=this.layout.gap+this.layout.columnWidth))):'vertical'===this.settings.axis&&(t=this.contents.textHeight()),(this._needsReframe||e!=this._width||t!=this._height)&&this.reframe(e,t),this._expanding=!1)}reframe(e,t){var n;(0,r.isNumber)(e)&&(this.element.style.width=e+'px',this.iframe.style.width=e+'px',this._width=e),(0,r.isNumber)(t)&&(this.element.style.height=t+'px',this.iframe.style.height=t+'px',this._height=t);var i=this.prevBounds?e-this.prevBounds.width:e,a=this.prevBounds?t-this.prevBounds.height:t;n={width:e,height:t,widthDelta:i,heightDelta:a},this.pane&&this.pane.render(),this.onResize(this,n),this.emit(h.EVENTS.VIEWS.RESIZED,n),this.prevBounds=n,this.elementBounds=(0,r.bounds)(this.element)}load(e){var t=new r.defer,n=t.promise;if(!this.iframe)return t.reject(new Error('No Iframe Available')),n;if(this.iframe.onload=function(e){this.onLoad(e,t)}.bind(this),'blobUrl'===this.settings.method)this.blobUrl=(0,r.createBlobUrl)(e,'application/xhtml+xml'),this.iframe.src=this.blobUrl;else if('srcdoc'===this.settings.method)this.iframe.srcdoc=e;else{if(this.document=this.iframe.contentDocument,!this.document)return t.reject(new Error('No Document Available')),n;this.iframe.contentDocument.open(),this.iframe.contentDocument.write(e),this.iframe.contentDocument.close()}return n}onLoad(e,t){this.window=this.iframe.contentWindow,this.document=this.iframe.contentDocument,this.contents=new p.default(this.document,this.document.body,this.section.cfiBase,this.section.index),this.rendering=!1;var n=this.document.querySelector('link[rel=\'canonical\']');n?n.setAttribute('href',this.section.canonical):(n=this.document.createElement('link'),n.setAttribute('rel','canonical'),n.setAttribute('href',this.section.canonical),this.document.querySelector('head').appendChild(n)),this.contents.on(h.EVENTS.CONTENTS.EXPAND,()=>{this.displayed&&this.iframe&&(this.expand(),this.contents&&this.layout.format(this.contents))}),this.contents.on(h.EVENTS.CONTENTS.RESIZE,()=>{this.displayed&&this.iframe&&(this.expand(),this.contents&&this.layout.format(this.contents))}),t.resolve(this.contents)}setLayout(e){this.layout=e,this.contents&&(this.layout.format(this.contents),this.expand())}setAxis(e){'scrolled'===this.layout.props.flow&&(e='vertical'),this.settings.axis=e,this.element.style.flex='horizontal'==e?'none':'initial',this.size()}addListeners(){}removeListeners(){}display(e){var t=new r.defer;return this.displayed?t.resolve(this):this.render(e).then(function(){this.emit(h.EVENTS.VIEWS.DISPLAYED,this),this.onDisplayed(this),this.displayed=!0,t.resolve(this)}.bind(this),function(e){t.reject(e,this)}),t.promise}show(){this.element.style.visibility='visible',this.iframe&&(this.iframe.style.visibility='visible'),this.emit(h.EVENTS.VIEWS.SHOWN,this)}hide(){this.element.style.visibility='hidden',this.iframe.style.visibility='hidden',this.stopExpanding=!0,this.emit(h.EVENTS.VIEWS.HIDDEN,this)}offset(){return{top:this.element.offsetTop,left:this.element.offsetLeft}}width(){return this._width}height(){return this._height}position(){return this.element.getBoundingClientRect()}locationOf(e){var t=this.iframe.getBoundingClientRect(),n=this.contents.locationOf(e,this.settings.ignoreClass);return{left:n.left,top:n.top}}onDisplayed(){}onResize(){}bounds(e){return(e||!this.elementBounds)&&(this.elementBounds=(0,r.bounds)(this.element)),this.elementBounds}highlight(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2];if(this.contents){var i=this.contents.range(e),a=()=>{this.emit(h.EVENTS.VIEWS.MARK_CLICKED,e,t)};t.epubcfi=e,this.pane||(this.pane=new u.Pane(this.iframe,this.element));var s=new u.Highlight(i,'epubjs-hl',t,{fill:'yellow',"fill-opacity":'0.3',"mix-blend-mode":'multiply'}),o=this.pane.addMark(s);return this.highlights[e]={mark:o,element:o.element,listeners:[a,n]},o.element.setAttribute('ref','epubjs-hl'),o.element.addEventListener('click',a),o.element.addEventListener('touchstart',a),n&&(o.element.addEventListener('click',n),o.element.addEventListener('touchstart',n)),o}}underline(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2];if(this.contents){var i=this.contents.range(e),a=()=>{this.emit(h.EVENTS.VIEWS.MARK_CLICKED,e,t)};t.epubcfi=e,this.pane||(this.pane=new u.Pane(this.iframe,this.element));var s=new u.Underline(i,'epubjs-ul',t,{stroke:'black',"stroke-opacity":'0.3',"mix-blend-mode":'multiply'}),o=this.pane.addMark(s);return this.underlines[e]={mark:o,element:o.element,listeners:[a,n]},o.element.setAttribute('ref','epubjs-ul'),o.element.addEventListener('click',a),o.element.addEventListener('touchstart',a),n&&(o.element.addEventListener('click',n),o.element.addEventListener('touchstart',n)),o}}mark(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2];if(this.contents){if(e in this.marks){var a=this.marks[e];return a}var s=this.contents.range(e);if(s){var o=s.commonAncestorContainer,r=1===o.nodeType?o:o.parentNode,l=()=>{this.emit(h.EVENTS.VIEWS.MARK_CLICKED,e,t)};s.collapsed&&1===o.nodeType?(s=new Range,s.selectNodeContents(o)):s.collapsed&&(s=new Range,s.selectNodeContents(r));var d,c,p;if('pre-paginated'===this.layout.name||'horizontal'!==this.settings.axis){var u=s.getBoundingClientRect();d=u.top,c=u.right}else for(var g=s.getClientRects(),m=void 0,f=0;f!=g.length;f++)m=g[f],(!p||m.left<p)&&(p=m.left,c=p+this.layout.columnWidth-this.layout.gap,d=m.top);var i=this.document.createElement('a');return i.setAttribute('ref','epubjs-mk'),i.style.position='absolute',i.style.top=`${d}px`,i.style.left=`${c}px`,i.dataset.epubcfi=e,t&&Object.keys(t).forEach((e)=>{i.dataset[e]=t[e]}),n&&(i.addEventListener('click',n),i.addEventListener('touchstart',n)),i.addEventListener('click',l),i.addEventListener('touchstart',l),this.element.appendChild(i),this.marks[e]={element:i,listeners:[l,n]},r}}}unhighlight(e){var t;e in this.highlights&&(t=this.highlights[e],this.pane.removeMark(t.mark),t.listeners.forEach((e)=>{e&&t.element.removeEventListener('click',e)}),delete this.highlights[e])}ununderline(e){var t;e in this.underlines&&(t=this.underlines[e],this.pane.removeMark(t.mark),t.listeners.forEach((e)=>{e&&t.element.removeEventListener('click',e)}),delete this.underlines[e])}unmark(e){var t;e in this.marks&&(t=this.marks[e],this.element.removeChild(t.element),t.listeners.forEach((e)=>{e&&t.element.removeEventListener('click',e)}),delete this.marks[e])}destroy(){for(var e in this.highlights)this.unhighlight(e);for(var t in this.underlines)this.ununderline(t);for(var n in this.marks)this.unmark(n);this.blobUrl&&(0,r.revokeBlobUrl)(this.blobUrl),this.displayed&&(this.displayed=!1,this.removeListeners(),this.stopExpanding=!0,this.element.removeChild(this.iframe),this.iframe=null,this._textWidth=null,this._textHeight=null,this._width=null,this._height=null)}}(0,o.default)(g.prototype),t.default=g,e.exports=t['default']},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n=t.getBoundingClientRect(),i=e.getBoundingClientRect();return{top:i.top-n.top,left:i.left-n.left,height:e.scrollHeight,width:e.scrollWidth}}function s(e,t){e.style.top=`${t.top}px`,e.style.left=`${t.left}px`,e.style.height=`${t.height}px`,e.style.width=`${t.width}px`}function o(e,t){return t.right<=e.right&&t.left>=e.left&&t.top>=e.top&&t.bottom<=e.bottom}Object.defineProperty(t,'__esModule',{value:!0}),t.Underline=t.Highlight=t.Mark=t.Pane=void 0;var r=n(56),l=i(r),d=n(57),c=i(d);t.Pane=class{constructor(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:document.body;this.target=e,this.element=l.default.createElement('svg'),this.marks=[],this.element.style.position='absolute',this.element.setAttribute('pointer-events','none'),c.default.proxyMouse(this.target,this.marks),this.container=t,this.container.appendChild(this.element),this.render()}addMark(e){var t=l.default.createElement('g');return this.element.appendChild(t),e.bind(t,this.container),this.marks.push(e),e.render(),e}removeMark(e){var t=this.marks.indexOf(e);if(-1!==t){var n=e.unbind();this.element.removeChild(n),this.marks.splice(t,1)}}render(){s(this.element,a(this.target,this.container));var e=!0,t=!1,n;try{for(var i=this.marks[Symbol.iterator](),o,r;!(e=(o=i.next()).done);e=!0)r=o.value,r.render()}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}};class p{constructor(){this.element=null}bind(e,t){this.element=e,this.container=t}unbind(){var e=this.element;return this.element=null,e}render(){}dispatchEvent(t){this.element&&this.element.dispatchEvent(t)}getBoundingClientRect(){return this.element.getBoundingClientRect()}getClientRects(){for(var e=[],t=this.element.firstChild;t;)e.push(t.getBoundingClientRect()),t=t.nextSibling;return e}filteredRanges(){var e=Array.from(this.range.getClientRects());return e.filter((t)=>{for(var n=0;n<e.length;n++){if(e[n]===t)return!0;var i=o(e[n],t);if(i)return!1}return!0})}}t.Mark=p;class h extends p{constructor(e,t,n,i){super(),this.range=e,this.className=t,this.data=n||{},this.attributes=i||{}}bind(e,t){for(var n in super.bind(e,t),this.data)this.data.hasOwnProperty(n)&&(this.element.dataset[n]=this.data[n]);for(var n in this.attributes)this.attributes.hasOwnProperty(n)&&this.element.setAttribute(n,this.attributes[n]);this.className&&this.element.classList.add(this.className)}render(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var e=this.element.ownerDocument.createDocumentFragment(),t=this.filteredRanges(),n=this.element.getBoundingClientRect(),a=this.container.getBoundingClientRect(),s=0,i=t.length;s<i;s++){var o=t[s],r=l.default.createElement('rect');r.setAttribute('x',o.left-n.left+a.left),r.setAttribute('y',o.top-n.top+a.top),r.setAttribute('height',o.height),r.setAttribute('width',o.width),e.appendChild(r)}this.element.appendChild(e)}}t.Highlight=h;t.Underline=class extends h{constructor(e,t,n,i){super(e,t,n,i)}render(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var e=this.element.ownerDocument.createDocumentFragment(),t=this.filteredRanges(),n=this.element.getBoundingClientRect(),a=this.container.getBoundingClientRect(),s=0,i=t.length;s<i;s++){var o=t[s],r=l.default.createElement('rect');r.setAttribute('x',o.left-n.left),r.setAttribute('y',o.top-n.top),r.setAttribute('height',o.height),r.setAttribute('width',o.width),r.setAttribute('fill','none');var d=l.default.createElement('line');d.setAttribute('x1',o.left-n.left+a.left),d.setAttribute('x2',o.left-n.left+a.left+o.width),d.setAttribute('y1',o.top-n.top+a.top+o.height-1),d.setAttribute('y2',o.top-n.top+a.top+o.height-1),d.setAttribute('stroke-width',1),d.setAttribute('stroke','black'),d.setAttribute('stroke-linecap','square'),e.appendChild(r),e.appendChild(d)}this.element.appendChild(e)}}},function(e,t){'use strict';function n(e){return document.createElementNS('http://www.w3.org/2000/svg',e)}Object.defineProperty(t,'__esModule',{value:!0}),t.createElement=n,t.default={createElement:n}},function(e,t){'use strict';function n(n,s){function t(o){for(var e=s.length-1;0<=e;e--){var r=s[e],t=o.clientX,l=o.clientY;if(o.touches&&o.touches.length&&(t=o.touches[0].clientX,l=o.touches[0].clientY),!!a(r,n,t,l)){r.dispatchEvent(i(o));break}}}if('iframe'===n.nodeName||'IFRAME'===n.nodeName)try{this.target=n.contentDocument}catch(e){this.target=n}else this.target=n;for(var e=['mouseup','mousedown','click','touchstart'],o=0,r;o<e.length;o++)r=e[o],this.target.addEventListener(r,(n)=>t(n),!1)}function i(t){var e=Object.assign({},t,{bubbles:!1});try{return new MouseEvent(t.type,e)}catch(i){var n=document.createEvent('MouseEvents');return n.initMouseEvent(t.type,!1,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),n}}function a(e,t,n,a){function s(e,t,n){var i=e.top-o.top,a=e.left-o.left,s=i+e.height,r=a+e.width;return i<=n&&a<=t&&s>n&&r>t}var o=t.getBoundingClientRect(),r=e.getBoundingClientRect();if(!s(r,n,a))return!1;for(var l=e.getClientRects(),d=0,i=l.length;d<i;d++)if(s(l[d],n,a))return!0;return!1}Object.defineProperty(t,'__esModule',{value:!0}),t.proxyMouse=n,t.clone=i,t.default={proxyMouse:n}},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var i=n(0),a=n(59),s=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default=class{constructor(e){this.settings=e||{},this.id='epubjs-container-'+(0,i.uuid)(),this.container=this.create(this.settings),this.settings.hidden&&(this.wrapper=this.wrap(this.container))}create(e){var t=e.height,n=e.width,a=e.overflow||!1,s=e.axis||'vertical',o=e.direction;e.height&&(0,i.isNumber)(e.height)&&(t=e.height+'px'),e.width&&(0,i.isNumber)(e.width)&&(n=e.width+'px');var r=document.createElement('div');return r.id=this.id,r.classList.add('epub-container'),r.style.wordSpacing='0',r.style.lineHeight='0',r.style.verticalAlign='top',r.style.position='relative','horizontal'===s&&(r.style.display='flex',r.style.flexDirection='row',r.style.flexWrap='nowrap'),n&&(r.style.width=n),t&&(r.style.height=t),a&&(r.style.overflow=a),o&&(r.dir=o,r.style.direction=o),o&&this.settings.fullsize&&(document.body.style.direction=o),r}wrap(e){var t=document.createElement('div');return t.style.visibility='hidden',t.style.overflow='hidden',t.style.width='0',t.style.height='0',t.appendChild(e),t}getElement(e){var t;if((0,i.isElement)(e)?t=e:'string'==typeof e&&(t=document.getElementById(e)),!t)throw new Error('Not an Element');return t}attachTo(e){var t=this.getElement(e),n;if(t)return n=this.settings.hidden?this.wrapper:this.container,t.appendChild(n),this.element=t,t}getContainer(){return this.container}onResize(e){(0,i.isNumber)(this.settings.width)&&(0,i.isNumber)(this.settings.height)||(this.resizeFunc=(0,s.default)(e,50),window.addEventListener('resize',this.resizeFunc,!1))}onOrientationChange(e){this.orientationChangeFunc=e,window.addEventListener('orientationchange',this.orientationChangeFunc,!1)}size(e,t){var n;null===e&&(n=this.element.getBoundingClientRect(),n.width&&(e=n.width,this.container.style.width=n.width+'px')),null===t&&(n=n||this.element.getBoundingClientRect(),n.height&&(t=n.height,this.container.style.height=n.height+'px')),(0,i.isNumber)(e)||(n=this.container.getBoundingClientRect(),e=n.width),(0,i.isNumber)(t)||(n=n||this.container.getBoundingClientRect(),t=n.height),this.containerStyles=window.getComputedStyle(this.container),this.containerPadding={left:parseFloat(this.containerStyles['padding-left'])||0,right:parseFloat(this.containerStyles['padding-right'])||0,top:parseFloat(this.containerStyles['padding-top'])||0,bottom:parseFloat(this.containerStyles['padding-bottom'])||0};var a=(0,i.windowBounds)();return e||(e=a.width),(this.settings.fullsize||!t)&&(t=a.height),{width:e-this.containerPadding.left-this.containerPadding.right,height:t-this.containerPadding.top-this.containerPadding.bottom}}bounds(){var e;return'visible'!==this.container.style.overflow&&(e=this.container&&this.container.getBoundingClientRect()),e&&e.width&&e.height?e:(0,i.windowBounds)()}getSheet(){var e=document.createElement('style');return e.appendChild(document.createTextNode('')),document.head.appendChild(e),e.sheet}addStyleRules(e,t){var n='#'+this.id+' ',i='';this.sheet||(this.sheet=this.getSheet()),t.forEach(function(e){for(var t in e)e.hasOwnProperty(t)&&(i+=t+':'+e[t]+';')}),this.sheet.insertRule(n+e+' {'+i+'}',0)}axis(e){'horizontal'===e?(this.container.style.display='flex',this.container.style.flexDirection='row',this.container.style.flexWrap='nowrap'):this.container.style.display='block'}direction(e){this.container&&(this.container.dir=e,this.container.style.direction=e),this.settings.fullsize&&(document.body.style.direction=e)}destroy(){var e;this.element&&(e=this.settings.hidden?this.wrapper:this.container,this.element.contains(this.container)&&this.element.removeChild(this.container),window.removeEventListener('resize',this.resizeFunc),window.removeEventListener('orientationChange',this.orientationChangeFunc))}},e.exports=t['default']},function(e,t,n){var i=n(20),a=n(14);e.exports=function(e,t,n){var s=!0,o=!0;if('function'!=typeof e)throw new TypeError('Expected a function');return a(n)&&(s='leading'in n?!!n.leading:s,o='trailing'in n?!!n.trailing:o),i(e,t,{leading:s,maxWait:t,trailing:o})}},function(e,t,n){var i=n(21);e.exports=function(){return i.Date.now()}},function(e,t,n){(function(t){var n='object'==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(t,n(8))},function(e,t,n){var i=n(14),a=n(63),s=0/0,o=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,d=/^0o[0-7]+$/i,c=parseInt;e.exports=function(e){if('number'==typeof e)return e;if(a(e))return s;if(i(e)){var t='function'==typeof e.valueOf?e.valueOf():e;e=i(t)?t+'':t}if('string'!=typeof e)return 0===e?e:+e;e=e.replace(o,'');var n=l.test(e);return n||d.test(e)?c(e.slice(2),n?2:8):r.test(e)?s:+e}},function(e,t,n){var i=n(64),a=n(67);e.exports=function(e){return'symbol'==typeof e||a(e)&&i(e)=='[object Symbol]'}},function(e,t,n){var i=n(22),a=n(65),s=n(66),o=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?'[object Undefined]':'[object Null]':o&&o in Object(e)?a(e):s(e)}},function(e,t,n){var i=n(22),a=Object.prototype,s=a.hasOwnProperty,o=a.toString,r=i?i.toStringTag:void 0;e.exports=function(e){var t=s.call(e,r),n=e[r];try{e[r]=void 0}catch(t){}var i=o.call(e);return t?e[r]=n:delete e[r],i}},function(e){var t=Object.prototype,n=t.toString;e.exports=function(e){return n.call(e)}},function(e){e.exports=function(e){return null!=e&&'object'==typeof e}},function(e,t){'use strict';Object.defineProperty(t,'__esModule',{value:!0});t.default=class{constructor(e){this.container=e,this._views=[],this.length=0,this.hidden=!1}all(){return this._views}first(){return this._views[0]}last(){return this._views[this._views.length-1]}indexOf(e){return this._views.indexOf(e)}slice(){return this._views.slice.apply(this._views,arguments)}get(e){return this._views[e]}append(e){return this._views.push(e),this.container&&this.container.appendChild(e.element),this.length++,e}prepend(e){return this._views.unshift(e),this.container&&this.container.insertBefore(e.element,this.container.firstChild),this.length++,e}insert(e,t){return this._views.splice(t,0,e),this.container&&(t<this.container.children.length?this.container.insertBefore(e.element,this.container.children[t]):this.container.appendChild(e.element)),this.length++,e}remove(e){var t=this._views.indexOf(e);-1<t&&this._views.splice(t,1),this.destroy(e),this.length--}destroy(e){e.displayed&&e.destroy(),this.container&&this.container.removeChild(e.element),e=null}forEach(){return this._views.forEach.apply(this._views,arguments)}clear(){var e=this.length,t;if(this.length){for(var n=0;n<e;n++)t=this._views[n],this.destroy(t);this._views=[],this.length=0}}find(e){for(var t=this.length,n=0,i;n<t;n++)if(i=this._views[n],i.displayed&&i.section.index==e.index)return i}displayed(){for(var e=[],t=this.length,n=0,i;n<t;n++)i=this._views[n],i.displayed&&e.push(i);return e}show(){for(var e=this.length,t=0,n;t<e;t++)n=this._views[t],n.displayed&&n.show();this.hidden=!1}hide(){for(var e=this.length,t=0,n;t<e;t++)n=this._views[t],n.displayed&&n.hide();this.hidden=!0}},e.exports=t['default']},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0});var a=n(0),s=n(19),r=i(s),l=n(3),d=n(20),c=i(d);class p extends r.default{constructor(e){super(e),this.name='continuous',this.settings=(0,a.extend)(this.settings||{},{infinite:!0,overflow:void 0,axis:void 0,flow:'scrolled',offset:500,offsetDelta:250,width:void 0,height:void 0}),(0,a.extend)(this.settings,e.settings||{}),'undefined'!=e.settings.gap&&0===e.settings.gap&&(this.settings.gap=e.settings.gap),this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,flow:this.settings.flow,layout:this.layout,width:0,height:0,forceEvenPages:!1},this.scrollTop=0,this.scrollLeft=0}display(e,t){return r.default.prototype.display.call(this,e,t).then(function(){return this.fill()}.bind(this))}fill(e){var t=e||new a.defer;return this.q.enqueue(()=>{return this.check()}).then((e)=>{e?this.fill(t):t.resolve()}),t.promise}moveTo(e){var t=0,n=0,i=0,a=0;this.isPaginated?(t=o(e.left/this.layout.delta)*this.layout.delta,i=t+this.settings.offset):(n=e.top,a=e.top+this.settings.offset),(0<t||0<n)&&this.scrollBy(t,n,!0)}afterResized(e){this.emit(l.EVENTS.MANAGERS.RESIZE,e.section)}removeShownListeners(e){e.onDisplayed=function(){}}add(e){var t=this.createView(e);return this.views.append(t),t.on(l.EVENTS.VIEWS.RESIZED,()=>{t.expanded=!0}),t.on(l.EVENTS.VIEWS.AXIS,(e)=>{this.updateAxis(e)}),t.onDisplayed=this.afterDisplayed.bind(this),t.onResize=this.afterResized.bind(this),t.display(this.request)}append(e){var t=this.createView(e);return t.on(l.EVENTS.VIEWS.RESIZED,()=>{t.expanded=!0}),this.views.append(t),t.onDisplayed=this.afterDisplayed.bind(this),t}prepend(e){var t=this.createView(e);return t.on(l.EVENTS.VIEWS.RESIZED,(e)=>{this.counter(e),t.expanded=!0}),this.views.prepend(t),t.onDisplayed=this.afterDisplayed.bind(this),t}counter(e){'vertical'===this.settings.axis?this.scrollBy(0,e.heightDelta,!0):this.scrollBy(e.widthDelta,0,!0)}update(e){for(var t=this.bounds(),n=this.views.all(),s=n.length,o=[],r='undefined'==typeof e?this.settings.offset||0:e,l=new a.defer,d=[],c=0,i,p;c<s;c++)if(p=n[c],i=this.isVisible(p,r,r,t),!0===i){if(!p.displayed){var h=p.display(this.request).then(function(e){e.show()},()=>{p.hide()});d.push(h)}else p.show();o.push(p)}else this.q.enqueue(p.destroy.bind(p)),clearTimeout(this.trimTimeout),this.trimTimeout=setTimeout(function(){this.q.enqueue(this.trim.bind(this))}.bind(this),250);return d.length?Promise.all(d).catch((e)=>{l.reject(e)}):(l.resolve(),l.promise)}check(e,t){var n=new a.defer,i=[],s='horizontal'===this.settings.axis,o=this.settings.offset||0;e&&s&&(o=e),t&&!s&&(o=t);var r=this._bounds,l='rtl'===this.settings.direction,d=s&&l?-1:1,c=s?this.scrollLeft:this.scrollTop*d,p=s?r.width:r.height,h=s?this.container.scrollWidth:this.container.scrollHeight,u=()=>{var e=this.views.first(),t=e&&e.section.prev();t&&i.push(this.prepend(t))},g=()=>{var e=this.views.last(),t=e&&e.section.next();t&&i.push(this.append(t))};c+p+o>=h&&(s&&l?u():g()),0>c-o&&(s&&l?g():u());var m=i.map((e)=>{return e.displayed});return i.length?Promise.all(m).then(()=>{if('pre-paginated'===this.layout.name&&this.layout.props.spread)return this.check()}).then(()=>{return this.update(o)},(e)=>{return e}):(this.q.enqueue(function(){this.update()}.bind(this)),n.resolve(!1),n.promise)}trim(){for(var e=new a.defer,t=this.views.displayed(),n=t[0],s=t[t.length-1],o=this.views.indexOf(n),r=this.views.indexOf(s),l=this.views.slice(0,o),d=this.views.slice(r+1),c=0;c<l.length-1;c++)this.erase(l[c],l);for(var i=1;i<d.length;i++)this.erase(d[i]);return e.resolve(),e.promise}erase(e,t){var n,i;this.settings.height?(n=this.container.scrollTop,i=this.container.scrollLeft):(n=window.scrollY,i=window.scrollX);var a=e.bounds();this.views.remove(e),t&&('vertical'===this.settings.axis?this.scrollTo(0,n-a.height,!0):this.scrollTo(i-a.width,0,!0))}addEventListeners(){window.addEventListener('unload',function(){this.ignore=!0,this.destroy()}.bind(this)),this.addScrollListeners()}addScrollListeners(){var e;this.tick=a.requestAnimationFrame,this.settings.height?(this.prevScrollTop=this.container.scrollTop,this.prevScrollLeft=this.container.scrollLeft):(this.prevScrollTop=window.scrollY,this.prevScrollLeft=window.scrollX),this.scrollDeltaVert=0,this.scrollDeltaHorz=0,this.settings.height?(e=this.container,this.scrollTop=this.container.scrollTop,this.scrollLeft=this.container.scrollLeft):(e=window,this.scrollTop=window.scrollY,this.scrollLeft=window.scrollX),e.addEventListener('scroll',this.onScroll.bind(this)),this._scrolled=(0,c.default)(this.scrolled.bind(this),30),this.didScroll=!1}removeEventListeners(){var e;e=this.settings.height?this.container:window,e.removeEventListener('scroll',this.onScroll.bind(this))}onScroll(){var e=Math.abs,t=void 0,n=void 0,i='rtl'===this.settings.direction?-1:1;this.settings.height?(t=this.container.scrollTop,n=this.container.scrollLeft):(t=window.scrollY*i,n=window.scrollX*i),this.scrollTop=t,this.scrollLeft=n,this.ignore?this.ignore=!1:this._scrolled(),this.scrollDeltaVert+=e(t-this.prevScrollTop),this.scrollDeltaHorz+=e(n-this.prevScrollLeft),this.prevScrollTop=t,this.prevScrollLeft=n,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(function(){this.scrollDeltaVert=0,this.scrollDeltaHorz=0}.bind(this),150),this.didScroll=!1}scrolled(){this.q.enqueue(function(){this.check()}.bind(this)),this.emit(l.EVENTS.MANAGERS.SCROLL,{top:this.scrollTop,left:this.scrollLeft}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.emit(l.EVENTS.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft})}.bind(this))}next(){var e=this.settings.direction,t='pre-paginated'===this.layout.props.name&&this.layout.props.spread?2*this.layout.props.delta:this.layout.props.delta;this.views.length&&(this.isPaginated&&'horizontal'===this.settings.axis?this.scrollBy(t,0,!0):this.scrollBy(0,this.layout.height,!0),this.q.enqueue(function(){this.check()}.bind(this)))}prev(){var e=this.settings.direction,t='pre-paginated'===this.layout.props.name&&this.layout.props.spread?2*this.layout.props.delta:this.layout.props.delta;this.views.length&&(this.isPaginated&&'horizontal'===this.settings.axis?this.scrollBy(-t,0,!0):this.scrollBy(0,-this.layout.height,!0),this.q.enqueue(function(){this.check()}.bind(this)))}updateAxis(e,t){this.isPaginated||(e='vertical');(t||e!==this.settings.axis)&&(this.settings.axis=e,this.stage&&this.stage.axis(e),this.viewSettings.axis=e,this.mapping&&this.mapping.axis(e),this.layout&&'vertical'===e?this.layout.spread('none'):this.layout.spread(this.layout.settings.spread),this.settings.infinite=!('vertical'!==e))}}t.default=p,e.exports=t['default']}])});